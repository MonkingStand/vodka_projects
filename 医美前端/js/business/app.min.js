var indexPage={init:function(){this.appLogin()},domListener:function(){var e=this,t=!1;$(document).on("infinite",".infinite-scroll",function(){var i={begin:parseInt($("#obtainUserList ul").attr("data-begin")),rows:10};return $("#obtainUserList ul").hasClass("finished")&&$.detachInfiniteScroll($(".infinite-scroll")),!t&&(t=!0,$("#loaderContainer").empty().append('<div class="infinite-scroll-preloader"><div class="preloader"></div></div>'),e.getObtainUserList(i),void setTimeout(function(){t=!1},1500))}),$(".page").on("click",".panel-link",function(){var t=$(this).attr("data-obtainname"),i=$(this).attr("data-obtainmobile"),n=$(this).attr("data-real");e.viewObtainUser(t,i,n)}),$("#customerManagePanel").on("click",".item-link",function(){var e=$(this).attr("data-orderNo"),t=document.URL,i=t.slice(0,t.indexOf("/business"))+"/customer/loan_form.html?orderNo="+e,n=function(){$.hideIndicator(),$.popup("#qrcodePopup")};$.showIndicator(),setTimeout(function(){$.qrGenerate(document.getElementById("qrcodeContainer"),i,150,n)},500)})},userInfoInit:function(){$.getCookie("loginUserId")?($.getCookie("loginUserName")&&$("#businessName").text($.getCookie("loginUserName")),$.getCookie("loginMerchantName")&&$("#merchantName").text($.getCookie("loginMerchantName"))):($.toast("请先登录！"),setTimeout(function(){window.location.href="../login.html"},1500))},viewObtainUser:function(e,t,i){var n=e,o=t;$("#customerManagePanel #theObtainUserName").text(n),$("#customerManagePanel #theObtainRealCheck").text(i);var a={merchantUserId:$.getCookie("loginUserId"),obtainUserMobile:o},r=function(e){for(var t=e.content,i=t.length,n="<ul>",o=0;o<i;o++){var a=$.orderStatusTrans(t[o].status),r=0==t[o].status?"item-link":"";n+='<li class="item-content loan-project '+r+'" data-orderNo="'+t[o].orderNo+'"><div class="item-inner"><div class="item-title">'+t[o].purpose+'</div><div class="item-after loan-status">'+a+"</div></div></div></li>"}n+="</ul>",$("#customerManagePanel #theObtainOrderList").empty().append(n),$.hideIndicator(),$.openPanel("#customerManagePanel")},s=function(e){$.alert("网络连接出错<br>请稍候重试"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/findOrderList.htm",a,r,s)},obtainUserListInit:function(){var e=this,t={begin:0,rows:10};$("#obtainUserList ul").removeClass("finished").addClass("init").empty().attr("data-begin","0"),e.getObtainUserList(t)},getObtainUserList:function(e){var t=this,i=function(e){t.renderObtainUserList(e)},n=function(e){$.hideIndicator(),console.info(e)};e.merchantUserId=$.getCookie("loginUserId"),$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getObtainUserList.htm",e,i,n)},renderObtainUserList:function(e){var t=this.getObtainUserListStr(e),i=parseInt($("#obtainUserList ul").attr("data-begin"))+10;setTimeout(function(){$.hideIndicator(),$(".infinite-scroll-preloader").remove(),$("#obtainUserList ul").hasClass("init")?0==e.count?($("#obtainUserList").addClass("no-obtain"),$("#obtainUserList ul").removeClass("init").addClass("finished")):$("#obtainUserList ul").removeClass("init").append(t).attr("data-begin",i):0==e.content.length?($("#obtainUserList").addClass("no-more-obtain"),$("#obtainUserList ul").addClass("finished")):$("#obtainUserList ul").append(t).attr("data-begin",i)},1e3)},getObtainUserListStr:function(e){for(var t=e.content,i=t.length,n="",o=0;o<i;o++)if(t[o]){var a=$.realCheck(t[o].realCheck,["tongdunMobile","tongdunHeadPic"]),r="已实名"==a?"-active":"",s=t[o].realName?t[o].realName:"--";n+='<li data-obtainname="'+s+'" data-real="'+a+'" data-obtainmobile="'+t[o].mobile+'" class="item-content item-link customer-item panel-link"><div class="item-inner"><div class="item-title">'+s+'</div><div class="item-after"><i class="img-icon img-user-info'+r+'"></i></div></div></li>'}return n},appLogin:function(){var e=this;if($.getParameter("mobile")){var t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:$.getParameter("role")},i=function(t){"success"==t.status?($.saveUserInfo(t.object),e.userInfoInit(),e.obtainUserListInit(),e.domListener()):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重试"))},n=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",t,i,n),$.showIndicator()}else e.userInfoInit(),e.obtainUserListInit(),e.domListener()}},loanFormPage={init:function(){this.loanFormInit(),this.domListener()},domListener:function(){var e=this;$("#peroidRadioModalLink").on("click",function(){var e=$(this).find(".radio-val").attr("data-val"),t={textArr:["6个月","12个月"],valArr:["val1","val2"]};t.selectedIndex=t.valArr.indexOf(e),$.radioModal($(this),t)}),$("#refundRadioModalLink").on("click",function(){var e=$(this).find(".radio-val").attr("data-val"),t={textArr:["等额本息","等额本金"],valArr:["val1","val2"]};t.selectedIndex=t.valArr.indexOf(e),$.radioModal($(this),t)}),$("#generateOrderBtn").on("click",function(){e.submitValidation()&&($.showIndicator(),e.generateOrder())})},loanFormInit:function(){$.getCookie("loginUserId")&&$.getCookie("loginUserMobile")&&"2"==$.getCookie("loginUserRole")?($("#merchantName").text($.getCookie("loginMerchantName")),$("#merchantUserName").text($.getCookie("loginUserName")),$("#merchantNo").val($.getCookie("loginMerchantNo")),$("#merchantUserId").val($.getCookie("loginUserId")),$("#merchantUserMobile").val($.getCookie("loginUserMobile"))):($.toast("用户请先登录！"),setTimeout(function(){window.location.href="../login.html"},1500))},submitObj:function(){var e={},t=Date.parse(new Date),i=new Date(t+288e5);return $("#loanFormPage .submit-input").each(function(){var t=$(this).attr("id"),i=$(this).val();e[t]=i}),e.loanType=parseInt($.getCookie("loginUserRole")),e.applyCapital=parseInt($("#applyCapital").val()),e.period=parseInt($("#period").val().replace("个月","")),e.refundType="等额本息"==$("#refundType").val()?0:1,e.applyLogId="",e.obtainUserId="",e.effectiveDate=this.transISOTimeStr($.formatTime(t,"full")),e.deadDate=new Date(i.setMonth(i.getMonth()+e.period)).toISOString(),e.createDate=this.transISOTimeStr($.formatTime(t,"full")),e.proofImg="",e.latestRefundDate=this.transISOTimeStr($.formatTime(t,"full")),e.donePeroid=0,e.refundDate=(new Date).getDate(),e},generateOrder:function(){$.showIndicator();var e=this.submitObj(),t=function(e){"success"==e.status?($.hideIndicator(),$.alert("订单创建成功<br>请提醒借款用户在个人中心查看对应订单并提交",function(){$.router.back()})):($.hideIndicator(),$.alert(e.message))},i=function(e){$.hideIndicator(),console.info(e),$.alert("创建订单失败<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/add.htm",e,t,i)},shareByWechat:function(){var e=this.submitObj(),t=function(e){if("success"==e.status){var t=document.URL,i=t.slice(0,t.indexOf("/business"))+"/customer/loan_form.html?orderNo="+e.object.orderNo;$.setCookie("shareResultLink",i,300),business.loanFormPage.invokeWechatShare(i),$(".page").addClass("submitted"),wx.showOptionMenu(),setTimeout(function(){$.hideIndicator(),$.alert("提交订单成功<br>请在右上角菜单中分享给朋友")},2e3)}else wx.showOptionMenu(),$.hideIndicator(),$.alert(e.message)},i=function(e){console.info(e),$.hideIndicator(),$.toast("生成订单失败，请稍后重试")};$(".page").hasClass("submitted")?(wx.showOptionMenu(),$.hideIndicator(),$.alert("您已提交过本订单<br>请在右上角进行微信分享")):$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/add.htm",e,t,i)},wxConfigInit:function(){var e={url:document.URL},t=function(e){"success"==e.status?(wx.config({debug:!1,appId:e.object.appId,timestamp:e.object.timestamp,nonceStr:e.object.nonceStr,signature:e.object.signature,jsApiList:["checkJsApi","openLocation","getLocation","onMenuShareTimeline","onMenuShareAppMessage"]}),wx.hideOptionMenu()):$.alert("微信分享暂不可用<br>请使用二维码分享功能")},i=function(e){$.alert("微信接口初始化失败<br>请检查微信版本是否是最新版")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/share/wechatShareSign.htm",e,t,i)},invokeWechatShare:function(e){wx.ready(function(){wx.onMenuShareAppMessage({title:"《先用着》借款申请表",desc:"来自咨询师的借款申请分享，请完善信息，并进行申请操作",link:e,imgUrl:"",success:function(e){$.toast("分享成功")},cancel:function(e){}})})},shareByQrcode:function(){$.showIndicator();var e=this.submitObj(),t=function(e){if("success"==e.status){var t=document.URL,i=t.slice(0,t.indexOf("/business"))+"/customer/loan_form.html?orderNo="+e.object.orderNo,n=function(){$.hideIndicator(),$.popup("#qrcodePopup")};$.setCookie("shareResultLink",i,300),$(".page").addClass("submitted"),business.loanFormPage.invokeWechatShare(i),$.qrGenerate(document.getElementById("qrcodeContainer"),i,150,n)}else $.hideIndicator(),$.alert(e.message)},i=function(e){$.hideIndicator(),console.info(e),$.alert("生成二维码失败<br>请稍后重试")};if($(".page").hasClass("submitted")){var n=function(){$.hideIndicator(),$.popup("#qrcodePopup")};$.hideIndicator(),$.qrGenerate(document.getElementById("qrcodeContainer"),$.getCookie("shareResultLink"),150,n)}else $.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/add.htm",e,t,i)},submitValidation:function(){var e=$.trim($("#obtainUserName").val()),t=$.trim($("#obtainUserMobile").val()),i=$.trim($("#applyCapital").val()),n=/^1[34578]\d{9}$/;return""==e?($.toast("客户姓名不能为空！",750),!1):""==t?($.toast("客户手机号不能为空！",750),!1):n.test(t)?""==i?($.toast("请填写借款金额！",750),!1):!(parseFloat(i)<3e3)||($.toast("借款金额不得低于3000！",750),!1):($.toast("客户手机号填写有误！",750),!1)},transISOTimeStr:function(e){var t=e.replace(" ","T"),i=new Date(Number(new Date(t)));return i.toISOString()}},userInfoPage={init:function(){this.userInfoInit(),this.domListener()},domListener:function(){},userInfoInit:function(){var e={mobile:$.getCookie("loginUserMobile"),password:$.getCookie("loginUserPassword"),userId:$.getCookie("loginUserId")},t=function(e){if("success"==e.status){var t=e.object.merchantUser;$.saveUserInfo(t);for(var i in t)$("#"+i)&&t[i]&&$("#"+i).text(t[i]);$.hideIndicator()}else $.alert("获取用户信息失败<br>请稍候重试")},i=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/merchantUser/getMerchantUser.htm",e,t,i)}},editUserPage={init:function(){this.userInfoInit(),this.domListener()},domListener:function(){var e=this;$("#saveInfoBtn").on("click",function(){if(!e.submitValidation)return!1;var t=e.submitObj(),i=function(e){"fail"==e.status?$.alert("修改失败<br>请稍后重试！"):($.hideIndicator(),$.alert("信息修改成功",function(){$.router.back()}))},n=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/merchantUser/updateMerchantUser.htm",t,i,n)})},userInfoInit:function(){var e={mobile:$.getCookie("loginUserMobile"),password:$.getCookie("loginUserPassword"),userId:$.getCookie("loginUserId")},t=function(e){if("success"==e.status){var t=e.object.merchantUser;$.saveUserInfo(t);for(var i in t)$("#"+i)&&t[i]&&$("#"+i).val(t[i]);$("#password").val($.getCookie("loginUserPassword")),$("#userId").val($.getCookie("loginUserId")),$.hideIndicator()}else $.alert("获取用户信息失败<br>请稍候重试")},i=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/merchantUser/getMerchantUser.htm",e,t,i)},submitObj:function(){var e={};return $("#editUserPage .submit-input").each(function(){var t=$(this).attr("id"),i=$(this).val();e[t]=i}),e},submitValidation:function(){return!0}},customerInfoPage={init:function(){this.userInfoInit(),this.domListener()},domListener:function(){$(".popup-link").on("click",function(){var e=$(this).attr("data-popup");$.popup(e)})},userInfoInit:function(){}},editCustomerPage={init:function(){this.userInfoInit(),this.domListener()},domListener:function(){var e=this;$(".popup-link").on("click",function(){var e=$(this).attr("data-popup");$.popup(e)}),$(".upload-popup .img-input").on("click",function(){$.showIndicator(),setTimeout(function(){$.hideIndicator()},250)}).on("change",function(t){var i="#"+$(this).closest(".popup").attr("id"),n=($(this).attr("name"),t.target.files);e.imgPreview(n,i),$(this).closest(".popup").find(".upload-status").removeClass("init has-uploaded").addClass("not-uploaded"),$(".upload-popup .save-btn").removeClass("click-ban")}),$(".upload-popup .save-btn").on("click",function(){var e=$(this).closest(".popup").attr("id"),t=$(this).attr("data-type")+"Form",i=function(t){$.hideIndicator(),$.toast("上传成功"),$("#"+e).find(".upload-status").removeClass("not-uploaded").addClass("has-uploaded"),$("#"+e+"Link").find(".img-icon").removeClass("img-camera").addClass("img-camera-active"),$("#"+e+"Link").closest(".item-content").find(".submit-input").val(t.object),$.setCookie($("#"+e+"Link").closest(".item-content").find(".submit-input").attr("id"),t.object,600)},n=function(e){$.hideIndicator(),$.toast("上传失败")},o=new FormData(document.getElementById(t));$.showIndicator(),$.ajaxFileAction(defaultConfig.domain+defaultConfig.project+"/ossUtil/uploadFile.htm",o,i,n)}),$("#saveInfoBtn").on("click",function(){if(!e.submitValidation)return!1})},imgPreview:function(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=/^image\//;if(o.test(n.type)){var a=document.createElement("img");a.classList.add("tmp-upload"),a.file=n;var r=new FileReader;r.onload=function(e){return function(t){e.src=t.target.result,imgSrc=e.src}}(a),r.readAsDataURL(n),$(t+" .img-container .tmp-upload").remove(),$(t+" .img-container").removeClass("not-uploaded"),$(t+" .img-container").append(a)}}},userInfoInit:function(){return!0},submitObj:function(){var e={};return $("#editUserPage .submit-input").each(function(){var t=$(this).attr("id"),i=$(this).val();e[t]=i}),e},submitValidation:function(){}},business={indexPage:indexPage,loanFormPage:loanFormPage,userInfoPage:userInfoPage,editUserPage:editUserPage,customerInfoPage:customerInfoPage,editCustomerPage:editCustomerPage};window.bussiness=business,$(document).on("pageInit",function(){router.setPage()}),$.init();