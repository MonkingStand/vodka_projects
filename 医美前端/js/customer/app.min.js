var loanFormPage={init:function(){this.orderInit(),this.domListener()},domListener:function(){var e=this;$(".popup-link").on("click",function(){var t=$(this).attr("data-popup"),a=function(){var a=/^\d+/g,i=document.URL.split("=")[1],o=a.exec(i)[0],n=t,r=t+"_"+o,l="../upload_img.html?imgType="+n+"&imgName="+r+"&originUrl=null",s=parent.document.getElementById(t+"Frame").contentWindow.location.href;s.indexOf("init=1")!=-1&&$("#"+t+"Frame").attr("src",l),$.popup("#"+t+"UploadPopup"),e.checkWXRuntime()};e.loginCheck(a)}),$(".close-popup").on("click",function(){var e=parent.document.getElementById("proofImgFrame").contentWindow.location.href;if(e.indexOf("viewUrl=")!=-1){var t=e.split("viewUrl=")[1].split("&")[0];$("#proofImgUploadPopupLink .img-icon").removeClass("img-camera").addClass("img-camera-active"),$("#proofImg").val(t)}$.closeModal("#proofImgUploadPopup")}),$('input[name="agreementCheckbox"]').change(function(){var t=$(this);$(".apply-btn-container .button");if(t.prop("checked")){var a=[{text:"立即申请",bg:"theme",onClick:function(){e.submitValidation()&&e.submitApply(),t.prop("checked",!1)}}],i=[{text:"取消",bg:"danger",onClick:function(){t.prop("checked",!1)}}],o=[a,i];$.actions(o)}})},loginCheck:function(e){var t=this,a=!!($.getCookie("loginUserId")&&$.getCookie("loginUserMobile")&&$.getCookie("loginUserPassword")&&$.getCookie("loginUserRole")),i=function(){$.closeModal("#loginPopup"),e()};a?e():$.alert("用户还未登录<br>请先登录",function(){$.popup("#loginPopup"),t.loginOperate(i)})},orderInit:function(){var e=this;$.showIndicator();var t=/^\d+/g,a=document.URL.split("=")[1],i=t.exec(a)[0],o={orderNo:i},n=function(t){var a=t.object.loanOrder;$.setCookie("loginUserReal",t.object.creditObtainUser.realCheck,3600),$("#loginPopup #mobileNumber").val(a.obtainUserMobile),e.userVerify(a),$("#merchantName").text(t.object.creditMerchantUser.merchantName),$("#merchantUserName").text(t.object.creditMerchantUser.realName),0!=a.status&&($(".agreement-checkbox-container").remove(),$("#orderContent").remove(),$("#orderStatus").removeClass("hidden"),$("#orderStatus .order-num").text(a.orderNo));for(var i in a)$("#"+i).val(a[i]);a.proofImg&&($("#proofImgUploadPopupLink .img-icon").removeClass("img-camera").addClass("img-camera-active"),$("#proofImg").val(a.proofImg)),$("#peroidRadioModalLink span.radio-val").text(a.period+"个月"),$("#refundRadioModalLink span.radio-val").text(0==a.refundType?"等额本息":"等额本金"),$("#peroidRadioModalLink").on("click",function(){var e=$(this).find("span.radio-val").text(),t={textArr:["6个月","12个月"],valArr:["val1","val2"]};t.selectedIndex=t.textArr.indexOf(e),$(this).find(".radio-val").attr("data-val",t.valArr[t.selectedIndex]),$.radioModal($(this),t)}),$("#refundRadioModalLink").on("click",function(){var e=$(this).find("span.radio-val").text(),t={textArr:["等额本息","等额本金"],valArr:["val1","val2"]};t.selectedIndex=t.textArr.indexOf(e),$(this).find(".radio-val").attr("data-val",t.valArr[t.selectedIndex]),$.radioModal($(this),t)})},r=function(e){console.info(e),$.toast("订单初始化失败，请稍后重试")};$.setCookie("orderNo",i,3600),$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/creditObtainUserCheckOrderBeforeSubmit.htm",o,n,r)},userVerify:function(e){var t=function(){var e=$("#resendCodeBtn"),t=59,a=setInterval(function(){e.text("("+t+"s)"),t--<=0&&(clearInterval(a),e.text("重新发送").removeClass("click-ban"))},1e3);e.text("(60s)")},a=function(){var t={mobile:e.obtainUserMobile},a=function(e){$.setCookie("mobileVerifyCode",e.object.code,60)},i=function(e){$.toast("短信发送失败，请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/smsUtil/getCode.htm",t,a,i)},i=e.obtainUserMobile,o=i.split("");return o.splice(3,4,"****"),$("#mobileVerificationPopup .mobile-val").text(o.join("")),$.getCookie("mobileVerificationStatus")?($("#loanFormPage .content").removeClass("invisible"),$("#loanFormPage nav").removeClass("invisible"),!1):($.popup("#mobileVerificationPopup"),$("#resendCodeBtn").on("click",function(){$("#resendCodeBtn").addClass("click-ban"),$.getCookie("mobileVerifyCode")||a(),t()}),void $("#verifyBtn").on("click",function(){""==$("#verifyCode").val()?($.hideIndicator(),$.toast("请填写验证码")):$("#verifyCode").val()!=$.getCookie("mobileVerifyCode")?($.showIndicator(),setTimeout(function(){$.hideIndicator(),$.toast("验证码错误！")},1e3)):($.showIndicator(),$.clearCookie("mobileVerifyCode"),$.setCookie("mobileVerificationStatus",1,600),setTimeout(function(){$.hideIndicator(),$("#loanFormPage #orderContent").removeClass("invisible"),$("#loanFormPage nav").removeClass("invisible"),$.closeModal("#mobileVerificationPopup")},1e3))}))},submitObj:function(){var e={};$("#loanFormPage .submit-input").each(function(){var t=$(this).attr("id"),a=$(this).val();e[t]=a});var t=Date.parse(new Date),a=new Date(t+288e5);return e.period=parseInt(e.period.replace("个月","")),"0"!=e.refundType&&"1"!=e.refundType&&(e.refundType="等额本息"==e.refundType?0:1),e.createDate=this.transISOTimeStr(e.createDate),e.effectiveDate=a.toISOString(),e.deadDate=new Date(a.setMonth(a.getMonth()+e.period)).toISOString(),e},submitValidation:function(){var e=$.trim($("#obtainUserName").val()),t=$.trim($("#applyCapital").val()),a=$.trim($("#purpose").val()),i=$.trim($("#proofImg").val());return""==e?($.toast("客户姓名不能为空！",750),!1):""==t?($.toast("借款金额不能为空！",750),!1):""==a?($.toast("借款用途不能为空！",750),!1):""!=i||($.toast("凭证/单据照片不能为空！",750),$('input[name="agreementCheckbox"]').prop("checked",!1),!1)},submitApply:function(){var e=this;if("未实名"===$.realCheck($.getCookie("loginUserReal"),["tongdunMobile","tongdunHeadPic"])){var t=!!($.getCookie("loginUserMobile")&&$.getCookie("loginUserPassword")&&$.getCookie("loginUserRole")),a="还未实名认证<br>是否"+(t?"进行实名认证？":"登录并前往认证？");$.confirm(a,function(){var a=function(){$.closeModal("#loginPopup"),router.linkTo("real_info.html")};t?a():($.popup("#loginPopup"),e.loginOperate(a))},function(){$('input[name="agreementCheckbox"]').prop("checked",!1)})}else if("已实名"===$.realCheck($.getCookie("loginUserReal"),["tongdunMobile","tongdunHeadPic"])){var t=!!($.getCookie("loginUserMobile")&&$.getCookie("loginUserPassword")&&$.getCookie("loginUserRole")),a=t?"确认提交申请？":"还未登录<br>是否进行登录？";$.confirm(a,function(){var a=function(){var t=e.submitObj(),a=function(e){"fail"==e.status?$.alert(e.message):($(".agreement-checkbox-container").remove(),$("#orderContent").remove(),$("#orderStatus").removeClass("hidden"),$("#orderStatus .order-num").text($.getCookie("orderNo")),$.closeModal("#loginPopup"))},i=function(e){$.toast("提交失败")};return!!e.submitValidation()&&void $.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/update.htm",t,a,i)};t?a():($.popup("#loginPopup"),e.loginOperate(a))},function(){$('input[name="agreementCheckbox"]').prop("checked",!1)})}},loginOperate:function(e){var t=function(){var e=$.trim($("#mobileNumber").val()),t=$.trim($("#password").val()),a=/^1[34578]\d{9}$/;return""==e?($.toast("手机号不能为空！",750),!1):a.test(e)?""!=t||($.toast("密码不能为空！",750),!1):($.toast("手机号填写有误！",750),!1)},a=function(e){$.saveUserInfo(e)};$("#loginBtn").on("click",function(){var i={mobile:$.trim($("#mobileNumber").val()),password:$.trim($("#password").val()),role:"1",longitude:0,latitude:0,iMei:""},o=function(t){t.object?($.toast("登录成功"),a(t.object),setTimeout(function(){$.hideIndicator(),e()},1e3)):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重新登录！"))},n=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};return!!t()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",i,o,n),void $.showIndicator())})},checkWXRuntime:function(){var e=window.navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)&&($.alert('<div style="font-size:0.85em;">图片上传功能在微信内置浏览器存在问题<br>请打开右上角菜单用其他浏览器打开</div>'),!0)},transISOTimeStr:function(e){var t=e.replace(" ","T"),a=new Date(Number(new Date(t)));return a.toISOString()}},indexPage={init:function(){this.appLogin()},domListener:function(){$("#appDownload").on("click",function(){window.location.href=defaultConfig.domain+defaultConfig.project+"/html/customer/app_download.html"})},userInfoInit:function(){$.getCookie("loginUserId")?$.getCookie("loginUserName")&&($("#customerName").text($.getCookie("loginUserName")),"未实名"===$.realCheck($.getCookie("loginUserReal"),["tongdunMobile","tongdunHeadPic"])?$("#realCheck").removeClass("no-user-name has-checked").addClass("not-checked"):"已实名"===$.realCheck($.getCookie("loginUserReal"),["tongdunMobile","tongdunHeadPic"])&&$("#realCheck").removeClass("no-user-name not-checked").addClass("has-checked")):($.toast("请先登录！"),setTimeout(function(){window.location.href=defaultConfig.domain+defaultConfig.project+"/html/login.html"},1500))},appLogin:function(){var e=this;if($.getParameter("mobile")){var t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:$.getParameter("role"),longitude:0,latitude:0,iMei:""},a=function(t){"success"==t.status?($.saveUserInfo(t.object),e.userInfoInit(),e.domListener()):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重试"))},i=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",t,a,i),$.showIndicator(),$("#appDownload").remove()}else e.userInfoInit(),e.domListener(),$("#appDownload").removeClass("hidden")}},repayBillAllPage={init:function(){this.domListener()},domListener:function(){var e=this;$(".repay-bill-all-page").on("change",'.repay-list input[type="checkbox"]',function(){e.toggleRepay()}),$(".button.tab-link").on("click",function(){var e=$(this).attr("href");$(".summary-container").removeClass("active"),$('.summary-container[data-tab="'+e+'"]').addClass("active")})},countSummary:function(){var e=0;$('.repay-bill-all-page .tab.active .repay-list input[type="checkbox"]').each(function(){if($(this).prop("checked")){var t=parseFloat($(this).attr("data-amount"));e+=t}}),$(".repay-bill-all-page .summary-container.active .summary-val").text(e.toFixed(2))},toggleRepay:function(){var e=0,t=$(".repay-bill-all-page .summary-container.active .repay-btn a");this.countSummary(),$('.repay-bill-all-page .tab.active input[type="checkbox"]').each(function(){$(this).prop("checked")&&(e+=1)}),0==e?t.addClass("click-ban"):t.removeClass("click-ban")}},loanPage={init:function(){this.appLogin()},domListener:function(){var e=this,t=!1;$(document).on("infinite",".infinite-scroll",function(){var a={begin:parseInt($("#orderListMenu").attr("data-begin")),rows:10};return $("#orderListMenu").hasClass("finished")&&$.detachInfiniteScroll($(".infinite-scroll")),!t&&(t=!0,$("#loaderContainer").empty().append('<div class="infinite-scroll-preloader"><div class="preloader"></div></div>'),e.getOrderList(a),void setTimeout(function(){t=!1},1500))})},orderListInit:function(){var e=this,t={begin:0,rows:10};$("#orderListMenu").removeClass("finished").addClass("init").empty().attr("data-begin","0"),e.getOrderList(t)},getOrderList:function(e){var t=this,a=function(e){t.renderOrders(e)},i=function(e){$.alert("网络连接出错<br>请稍后重试！"),console.info(e)};e.obtainUserId=$.getCookie("loginUserId"),e.obtainUserMobile=$.getCookie("loginUserMobile"),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getPersonalOrderList.htm",e,a,i)},renderOrders:function(e){var t=this.getOrdersListStr(e),a=parseInt($("#orderListMenu").attr("data-begin"))+10;setTimeout(function(){$(".infinite-scroll-preloader").remove(),$("#orderListMenu").hasClass("init")?0==e.count?($("#orderListContainer").addClass("no-orders"),$("#orderListMenu").removeClass("init").addClass("finished")):$("#orderListMenu").removeClass("init").append(t).attr("data-begin",a):0==e.content.length?($("#orderListContainer").addClass("no-more-orders"),$("#orderListMenu").addClass("finished")):$("#orderListMenu").append(t).attr("data-begin",a)},1e3)},getOrdersListStr:function(e){for(var t=e.content,a=(t.length,""),i=$.getCookie("loginUserMobile"),o=0;o<t.length;o++){var n=e.content[o].order_no,r=parseInt(t[o].status),l=$.orderStatusTrans(t[o].status),s="";0==r||1==r||2==r||3==r||4==r||5==r||6==r?s="onclick=\"router.linkTo('order.html?orderNo="+n+"&mobile="+i+"')\"":7==r&&(s="onclick=\"router.linkTo('order_detail.html?orderNo="+n+"&mobile="+i+"')\""),a+='<li class="card"><div class="card-header row no-gutter" '+s+'"><div class="col-50 text-left loan-amount text-yellow text-lg text-bold">'+t[o].finalCapital+'</div><div class="col-50 text-right loan-status">'+l+'<i class="icon icon-right"></i></div></div><div class="card-content"><div class="card-content-inner"><p class="business-info">'+t[o].merchant_name+'</p><p class="added-info"><span class="loan-project">'+t[o].purpose+'</span><span class="loan-date">'+t[o].effective_date+"&nbsp;借</span></p></div></div></li>"}return a},checkRegister:function(){var e=this,t=$.getParameter("code"),a=Boolean(t);if(a){var i={code:t},o=function(t){var a={openId:t.object.openid},i=function(t){"success"==t.status?($.hideIndicator(),$.saveUserInfo(t.object),e.orderListInit()):($.hideIndicator(),$.toast("请先进行登录！"))},o=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/judgeRegist.htm",a,i,o)},n=function(e){$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/share/getwechatOpenId.htm",i,o,n)}else $.getCookie("loginUserId")?e.orderListInit():($.toast("请先登录！"),setTimeout(function(){window.location.href=defaultConfig.domain+defaultConfig.project+"/html/login.html"},1500))},appLogin:function(){var e=this;if($.getParameter("mobile")){var t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:$.getParameter("role"),longitude:0,latitude:0,iMei:""},a=function(t){"success"==t.status?($.saveUserInfo(t.object),e.checkRegister(),e.domListener()):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重试"))},i=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",t,a,i),$.showIndicator()}else e.checkRegister(),e.domListener()}},orderPage={init:function(){this.domListener(),this.orderInit()},domListener:function(){var e=this;$("#orderRemit").on("click",function(){router.linkTo("loan_form.html?orderNo="+$.getParameter("orderNo"))}),$("#applyRemit").on("click",function(){$.confirm("请核对借款金额及借款期数<br>确定提交？",function(){e.applyRemit()})}),$("#repayDetailPopupLink").on("click",function(){e.viewRepayDetail()})},orderInit:function(){var e={orderNo:$.getParameter("orderNo"),mobile:$.getParameter("mobile")},t=function(e){var t,a=e.object.merchantInfo,i=e.object.order,o=$("#orderPage"),n=$("#applyBtnContainer"),r=$("#orderBtnContainer");o.removeClass("invisible"),$("#orderPage .submit-input").each(function(){var e=$(this).attr("id");$(this).text(i[e])}),0==i.status?(t='<p class="text-lg text-bold apply-result">很可惜</p><p>您的订单还未提交</p>',r.removeClass("hidden")):2==i.status?t='<p class="text-lg text-bold apply-result">请稍等</p><p>您的借款申请正在审核</p>':3==i.status?t='<p class="text-lg text-bold apply-result">很抱歉</p><p>您的借款申请未通过审核</p>':4==i.status?t='<p class="text-lg text-bold apply-result">请稍等</p><p>您的借款申请正在审批中</p>':5==i.status?t='<p class="text-lg text-bold apply-result">很抱歉</p><p>您的借款申请未通过审批</p>':1==i.status?(t='<p class="text-lg text-bold apply-result">恭喜您</p><p>您的借款申请已通过审批，请确认</p>',n.removeClass("hidden"),$("#applyCapital").text(i.verifyCapital),$("#repayDetailPopupLink").removeClass("hidden")):6==i.status&&(t='<p class="text-lg text-bold apply-result">恭喜您</p><p>您的借款申请正等待财务放款</p>',$("#applyCapital").text(i.verifyCapital),$("#repayDetailPopupLink").removeClass("hidden")),$("#orderStatusTip").empty().append(t),$("#refundType").text(0==i.refundType?"等额本息":"等额本金"),$("#merchantName").text(a.merchantName),$("#realName").text(a.realName),$("#interestAll").text(parseFloat(i.loanInterestObtainFinal).toFixed(2))},a=function(e){$.alert("网络连接出错<br>请稍后重试！")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getOrderByNum.htm",e,t,a)},applyRemit:function(){var e={orderNo:$.getParameter("orderNo"),status:6},t=function(e){"fail"==e.status?($.hideIndicator(),$.alert(e.message)):($.hideIndicator(),$.alert("已提交后台<br>请耐心等待工作人员处理",function(){$.router.back()}))},a=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/updateLoanOrderStatus.htm",e,t,a)},viewRepayDetail:function(){var e={orderNo:$.getParameter("orderNo"),filter:"all"},t=function(e){for(var t=e.object.orderList,a=t.length,i="<ul>",o=0;o<a;o++){var n=t[o],r=o+1+"/"+a;i+='<li class="card bottom-border top-border"><div class="card-header"><div class="text-left repay-amount text-yellow text-lg text-bold">'+parseFloat(n.finalPrice).toFixed(2)+'</div><div class="text-right repay-status">'+r+'</div></div><div class="card-content"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50">本金：<span class="text-lg">'+n.instalmentCapital+'</span>元</div><div class="col-50">利息：<span class="text-lg">'+n.instalmentInterest+"</span>元</div></div></div></div></li>"}i+="</ul>",popupHTML='<div id="repayDetailPopup" class="popup repay-detail-popup"><header class="bar bar-nav"><a class="icon icon-down pull-right close-popup text-grey"></a><h1 class="title">分期详情概览</h1></header><div class="content"><div id="repayBillContainer" class="list-block cards-list">'+i+"</div></div></div>",setTimeout(function(){$.hideIndicator(),$.popup(popupHTML)},1e3)},a=function(e){$.alert("网络连接出错<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getRepaymentRecord.htm",e,t,a)}},orderDetailPage={init:function(){this.orderDetailInit(),this.domListener()},domListener:function(){var e=this;$("#contractPopupLink").on("click",function(){e.contactInit()});var t=$.getParameter("orderNo"),a=$.getParameter("mobile");$("#repayRecordLink").on("click",function(){router.linkTo("repay_record.html?orderNo="+t+"&mobile="+a)}),$("#repayBillLink").on("click",function(){router.linkTo("repay_bill_per.html?orderNo="+t+"&mobile="+a)}),$("#repayDetailLink").on("click",function(){router.linkTo("repay_detail.html?orderNo="+t+"&mobile="+a)})},orderDetailInit:function(){var e={orderNo:$.getParameter("orderNo"),mobile:$.getParameter("mobile")},t=function(e){if("success"==e.status){var t=e.object.order,a=t.effectiveDate,i=t.deadDate,o=parseInt(t.period)-parseInt(t.donePeriod);$("#usingCapital").text(parseFloat(e.object.usingMoney).toFixed(2)),0==o?$(".summary-info .repay-info").text("该笔额度已还清"):$("#periodVal").text(o),$("#applyCapital").text(parseFloat(t.verifyCapital).toFixed(2)),$("#contractExpire").text(a+" ~ "+i),$("#refundType").text(0==t.refundType?"等额本息":"等额本金"),$("#refundedPrincipal").text(parseFloat(e.object.instalmentCapitalAll).toFixed(2)),$("#refundedInterest").text(parseFloat(e.object.instalmentInterestAll).toFixed(2))}else $.alert("获取订单信息失败<br>请稍后重试"),console.info(e.message);$.hideIndicator()},a=function(e){$.alert("网络连接出错<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getOrderByNum.htm",e,t,a)},contactInit:function(){var e={orderNo:$.getParameter("orderNo")},t=function(e){if("fail"==e.status)$.hideIndicator(),$.alert("网络连接出错，请稍后重试"),console.info(e.message);else{var t=e.object;for(var a in t)$("#"+a).text(t[a]);$("#merchantBankUserName").text(t.merchantName);var i=t.effectiveDate.split(""),o=t.deadDate.split("");i[4]="年",i[7]="月",i.push("日"),o[4]="年",o[7]="月",o.push("日"),$("#startEndDateContainer").text(i.join("")+"起至"+o.join("")+"止"),setTimeout(function(){$.hideIndicator(),$.popup("#contractPopup"),$("#contractPopup").removeClass("init")},1e3)}},a=function(e){$.hideIndicator(),$.alert("网络连接出错，请稍后重试"),console.info(e)};$("#contractPopup").hasClass("init")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/medicalAgreement.htm",e,t,a)):$.popup("#contractPopup")}},repayBillPerPage={init:function(){this.repayBillInit(),this.domListener()},domListener:function(){var e=this;$(".repay-bill-per-page").on("change",'.repay-list input[type="radio"]',function(){e.toggleRepay()}),$("#repayBillBtn").on("click",function(){$.confirm("确定立即还款？",function(){e.repayBill()})})},repayBillInit:function(){var e=this,t={orderNo:$.getParameter("orderNo"),filter:"toRepay"},a=function(t){for(var a=t.content,i=a.length,o="<ul>",n=0;n<i;n++){var r=parseFloat(a[n].instalmentCapital),l=parseFloat(a[n].instalmentInterest),s=a[n].instalmentLatefee?parseFloat(a[n].instalmentLatefee):0,d=r+l+s;"2"!=a[n].payStatus&&"4"!=a[n].payStatus&&"9"!=a[n].payStatus&&(o+='<li><label class="label-checkbox item-content"><div class="item-inner"><div class="card"><div class="card-header"><div class="text-left repay-amount text-yellow text-lg text-bold">'+d.toFixed(2)+'</div><div class="text-right repay-status text-grey text-xs">'+a[n].instalmentRefundDate+'&nbsp;待还</div></div><div class="card-content added-info"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50 repayed-principal">本金：<span class="text-lg">'+r.toFixed(2)+'</span></div><div class="col-50 repayed-interest">利息：<span class="text-lg">'+l.toFixed(2)+'</span></div><div class="col-50 repayed-interest">违约金：<span class="text-lg">'+s.toFixed(2)+'</span></div></div></div></div></div></div><input type="radio" name="repay-item" data-amount="'+d.toFixed(2)+'" data-billno="'+a[n].instalmentNo+'"><div class="item-media"><i class="icon icon-form-checkbox"></i></div></label></li>')}o+="</ul>",$("#repayBillList").empty().append(o),e.pageEffectInit(),$.hideIndicator()},i=function(e){$.alert("网络连接出错<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getRepayOrderList.htm",t,a,i)},pageEffectInit:function(){$('.repay-bill-per-page .repay-list input[type="radio"]').eq(0).prop("checked",!0),this.countSummary()},countSummary:function(){var e=0;$('.repay-bill-per-page .repay-list input[type="radio"]').each(function(){if($(this).prop("checked")){var t=parseFloat($(this).attr("data-amount"));e+=t}}),$(".repay-bill-per-page .repay-summary .summary-val").text(e.toFixed(2))},toggleRepay:function(){var e=0,t=$(".repay-bill-per-page .repay-btn a");this.countSummary(),$('.repay-bill-per-page .repay-list input[type="radio"]').each(function(){$(this).prop("checked")&&(e+=1)}),0==e?t.addClass("click-ban"):t.removeClass("click-ban")},repayBill:function(){var e={userId:$.getCookie("loginUserId"),tradeNum:"",tradeName:"还款订单",amount:0},t=function(e){setTimeout(function(){$("#autoSubmitFormContainer").append(e),$("#autoSubmitFormContainer").find("#batchForm").submit()},1500)},a=function(e){$.hideIndicator(),$.alert("支付失败！")};$('.repay-bill-per-page .repay-list input[type="radio"]').each(function(){$(this).prop("checked")&&(e.tradeNum=$(this).attr("data-billno"),e.amount=100*parseFloat($(this).attr("data-amount")))}),$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/jdpay/submit.htm",e,t,a)}},repayRecordPage={init:function(){this.repayRecordInit(),this.domListener()},domListener:function(){},repayRecordInit:function(){var e={orderNo:$.getParameter("orderNo"),filter:"hasRepay"},t=function(e){for(var t=e.object.orderList,a=t.length,i="<ul>",o=0;o<a;o++){var n=t[o];i+='<li class="card"><div class="card-header row no-gutter"><div class="col-50 text-left repay-date text-sm">'+$.formatTime(n.payTime,"full")+'</div><div class="col-50 text-right"><span class="repay-amount text-yellow text-lg text-bold">'+parseFloat(n.finalPrice).toFixed(2)+'</span></div></div><div class="card-content"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50 text-sm repayed-principal">本金：<span class="text-bold">'+parseFloat(n.instalmentCapital).toFixed(2)+'</span>元</div><div class="col-50 text-sm handling-charge">利息：<span class="text-bold">'+parseFloat(n.instalmentInterest).toFixed(2)+'</span>元</div></div><div class="row no-gutter"><div class="col-50 text-sm">违约金：<span class="text-bold">'+parseFloat(n.instalmentLatefee).toFixed(2)+"</span>元</div></div></div></div></li>"}i+="</ul>",setTimeout(function(){0==a?$("#repayRecordContainer").empty().addClass("no-records"):$("#repayRecordContainer").empty().append(i),$.hideIndicator()},1e3)},a=function(e){$.alert("网络连接出错<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getRepaymentRecord.htm",e,t,a)}},repayDetailPage={init:function(){this.repayDetailInit(),this.domListener()},domListener:function(){},repayDetailInit:function(){var e={orderNo:$.getParameter("orderNo"),filter:"all"},t=function(e){for(var t=e.object.orderList,a=t.length,i="<ul>",o=0;o<a;o++){var n=t[o],r="0"==n.payStatus?" not-repayed":" has-repayed",l="0"==n.payStatus?"未还":"已还",s="0"==n.payStatus?n.instalmentRefundDate:n.payTime,d=o+1+"/"+a+"&nbsp;|&nbsp;"+$.formatTime(s)+l;i+='<li class="card bottom-border top-border'+r+'"><div class="card-header"><div class="text-left repay-amount text-yellow text-lg text-bold">'+parseFloat(n.finalPrice).toFixed(2)+'</div><div class="text-right repay-status">'+d+'</div></div><div class="card-content"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50">本金：<span class="text-lg">'+n.instalmentCapital+'</span>元</div><div class="col-50">利息：<span class="text-lg">'+n.instalmentInterest+"</span>元</div></div></div></div></li>"}i+="</ul>",setTimeout(function(){$("#repayBillContainer").empty().append(i),$.hideIndicator()},1e3)},a=function(e){$.alert("网络连接出错<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/loanOrder/getRepaymentRecord.htm",e,t,a)}},userInfoPage={init:function(){this.appLogin()},domListener:function(){$(".popup-link").on("click",function(){var e=$(this).attr("data-popup");$.popup(e)})},userInfoInit:function(){var e={mobile:$.getCookie("loginUserMobile"),password:$.getCookie("loginUserPassword"),userId:$.getCookie("loginUserId")},t=function(e){var t=e.object.obtainUser;$.saveUserInfo(e.object.obtainUser);for(var a in t)$("#"+a)&&t[a]&&$("#"+a).text(t[a]);$.hideIndicator()},a=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/getObtainUser.htm",e,t,a)},appLogin:function(){var e=this;if("app"==$.getParameter("platform")){var t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:$.getParameter("role")},a=function(t){"success"==t.status?($.saveUserInfo(t.object),e.userInfoInit(),e.domListener()):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重试"))},i=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",t,a,i),$.showIndicator(),$("#backBtnContainer").addClass("hidden")}else $("#backBtnContainer").removeClass("hidden"),e.userInfoInit(),e.domListener()}},editUserPage={init:function(){this.userInfoInit(),this.domListener()},domListener:function(){var e=this;$("#mobile").on("focus",function(){$.toast("手机号无法进行修改！")}),$("#saveInfoBtn").on("click",function(){var t=e.submitObj(),a=function(e){"fail"==e.status?$.alert("修改失败<br>请稍后重试！"):($.hideIndicator(),$.alert("信息修改成功",function(){$.router.back()}))},i=function(e){console.info(e),$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！")},o=function(){$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/updateObtainUser.htm",t,a,i)};e.submitValidation(o)})},imgPreview:function(e,t){for(var a=0;a<e.length;a++){var i=e[a],o=/^image\//;if(o.test(i.type)){var n=document.createElement("img");n.classList.add("tmp-upload"),n.file=i;var r=new FileReader;r.onload=function(e){return function(t){e.src=t.target.result,imgSrc=e.src}}(n),r.readAsDataURL(i),$(t+" .img-container .tmp-upload").remove(),$(t+" .img-container").removeClass("not-uploaded"),$(t+" .img-container").append(n)}}},userInfoInit:function(){var e={mobile:$.getCookie("loginUserMobile"),password:$.getCookie("loginUserPassword"),userId:$.getCookie("loginUserId")},t=function(e){var t=e.object.obtainUser;for(var a in t)$("#"+a)&&t[a]&&$("#"+a).val(t[a]);$("#password").val($.getCookie("loginUserPassword")),$("#userId").val($.getCookie("loginUserId")),$.hideIndicator()},a=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/getObtainUser.htm",e,t,a)},submitObj:function(){var e={};return $("#editUserPage .submit-input").each(function(){var t=$(this).attr("id"),a=$(this).val();e[t]=a}),e},submitValidation:function(e){var t=$.trim($("#idCard").val()),a=$.trim($("#bankCardNum").val()),i=$.trim($("#linkman1Name").val()),o=$.trim($("#linkman1Mobile").val()),n=$.trim($("#linkman2Name").val()),r=$.trim($("#linkman2Mobile").val()),l=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/,s=/^(\d{16}|\d{19})$/,d=/^1[34578]\d{9}$/;return t&&!l.test(t)?($.toast("身份证号填写有误！",750),!1):a&&!s.test(a)?($.toast("银行卡号填写有误！",750),!1):i&&o?d.test(o)?n&&r?r&&!d.test(r)?($.toast("联系人2手机号填写有误！",750),!1):void $.confirm("姓名、身份证号是否填写将会影响后续实名认证结果<br>确认提交？",function(){e()}):($.toast("请填写紧急联系人2的信息！",750),!1):($.toast("联系人1手机号填写有误！",750),!1):($.toast("请填写紧急联系人1的信息！",750),!1)}},creditManagementPage={init:function(){this.appLogin()},domListener:function(){$("#creditMobile").on("click",function(){var e=$(this).find(".authorize-status");e.hasClass("has-authorize")?$.confirm("已进行过授权<br>是否重新授权？",function(){router.linkTo("credit_mobile.html")}):e.hasClass("being-authorize")?$.confirm("授权结果获取中<br>是否重新授权？",function(){router.linkTo("credit_mobile.html")}):router.linkTo("credit_mobile.html")})},userInfoInit:function(){var e=$.realCheck($.getCookie("loginUserReal"),["tongdunMobile","tongdunHeadPic"]);$("#realResult").text(e)},creditMobileInit:function(){var e={obtainUserId:$.getCookie("loginUserId")},t=function(e){"success"==e.status?e.object&&(e.object.reportUrl?$("#creditMobile").find(".authorize-status").removeClass("not-authorize").addClass("has-authorize"):$("#creditMobile").find(".authorize-status").removeClass("not-authorize").addClass("being-authorize")):$.alert("获取运营商授权结果出错<br>请稍后重试")},a=function(e){$.alert("网络连接出错，请稍后重试"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/moxie/carrier/getReportDetail.htm",e,t,a)},appLogin:function(){var e=this;if("app"==$.getParameter("platform")){var t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:$.getParameter("role")},a=function(t){"success"==t.status?($.saveUserInfo(t.object),e.userInfoInit(),e.creditMobileInit()):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重试"))},i=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};e.domListener(),$.showIndicator(),$("#userInfoTitleContainer").addClass("hidden"),$("#userInfoTitleLink").addClass("hidden"),$("#backLinkContainer").addClass("hidden"),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",t,a,i)}else $("#userInfoTitleContainer").removeClass("hidden"),$("#userInfoTitleLink").removeClass("hidden"),$("#backLinkContainer").removeClass("hidden"),e.userInfoInit(),e.creditMobileInit(),e.domListener()}},realInfoPage={init:function(){this.appLogin()},domListener:function(){},realInfoInit:function(){var e=$.getCookie("loginUserReal");$("#realName").text($.getCookie("loginUserName")),$("#idCard").text($.getCookie("loginUserIdCard"));var t="已实名"==$.realCheck(e,["tongdunMobile"])?"已认证":"未认证";$("#mobileResult").text(t);var a="已实名"==$.realCheck(e,["tongdunHeadPic"])?"已认证":"未认证";$("#idimgResult").text(a);var i="已实名"==$.realCheck(e,["tongdunBankCard"])?"已认证":"未认证";$("#bankcardResult").text(i)},appLogin:function(){var e=this;if($.getParameter("mobile")){var t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:$.getParameter("role"),longitude:0,latitude:0,iMei:""},a=function(t){"success"==t.status?($.saveUserInfo(t.object),e.realInfoInit(),e.domListener()):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重试"))},i=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",t,a,i),
$.showIndicator()}else $("#backLinkContainer").removeClass("hidden"),e.realInfoInit()}},realMobilePage={init:function(){this.realInfoInit(),this.domListener()},domListener:function(){var e=this;$("#saveInfoBtn").on("click",function(){e.submitRealMobile()})},realInfoInit:function(){var e=$.realCheck($.getCookie("loginUserReal"),["tongdunMobile"]);$("#realName").val($.getCookie("loginUserName")),$("#idCard").val($.getCookie("loginUserIdCard")),$("#mobile").val($.getCookie("loginUserMobile")),"已实名"==e?$(".save-btn-container").remove():$(".save-btn-container").removeClass("hidden")},submitRealMobile:function(){var e=this,t=function(){var e={type:"tongdunMobile",mobile:$("#mobile").val(),idCard:$("#idCard").val(),realName:$("#realName").val()},t=function(e){"fail"==e.status?($.hideIndicator(),$.alert("实名认证未通过"),console.info(e.message)):$.alert("实名认证通过",function(){$.hideIndicator(),$.setCookie("loginUserReal",e.object,3600),$(".save-btn-container").remove(),$.router.back()}),$.hideIndicator()},a=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/verifyObtainUser.htm",e,t,a)};e.submitValidation(t)},submitValidation:function(e){var t=$.trim($("#realName").val()),a=$.trim($("#idCard").val());return""==t?($.toast("请先在个人资料中完善“真实姓名”！",750),!1):""==a?($.toast("请先在个人资料中完善“身份证号”！",750),!1):void $.confirm("确认提交？",function(){e()})}},realIdimgPage={init:function(){var e=this,t=function(){e.realInfoInit(),e.domListener()};this.loginCheck(t)},domListener:function(){var e=this;$("#idCardImgSamplesPopupLink").on("click",function(){$.popup("#idCardImgSamplesPopup")}),$("#idCardImgSamplesPopupCloseLink").on("click",function(){$.closeModal("#idCardImgSamplesPopup")}),$("#saveInfoBtn").on("click",function(){e.submitRealIdimg()}),$("#backBtn").on("click",function(){$.router.back()})},loginCheck:function(e){var t=this,a=!!($.getCookie("loginUserId")&&$.getCookie("loginUserMobile")&&$.getCookie("loginUserPassword")&&$.getCookie("loginUserRole")),i=function(){$.closeModal("#loginPopup"),e()};a?e():$.alert("用户还未登录<br>请先登录",function(){$.popup("#loginPopup"),t.loginOperate(i)})},loginOperate:function(e){var t=function(){var e=$.trim($("#mobileNumber").val()),t=$.trim($("#password").val()),a=/^1[34578]\d{9}$/;return""==e?($.toast("手机号不能为空！",750),!1):a.test(e)?""!=t||($.toast("密码不能为空！",750),!1):($.toast("手机号填写有误！",750),!1)},a=function(e){$.saveUserInfo(e)};$("#loginBtn").on("click",function(){var i={mobile:$.trim($("#mobileNumber").val()),password:$.trim($("#password").val()),role:"1",longitude:0,latitude:0,iMei:""},o=function(t){t.object?($.toast("登录成功"),a(t.object),setTimeout(function(){$.hideIndicator(),e()},1e3)):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重新登录！"))},n=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};return!!t()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",i,o,n),void $.showIndicator())})},realInfoInit:function(){var e=this,t={mobile:$.getCookie("loginUserMobile"),password:$.getCookie("loginUserPassword"),userId:$.getCookie("loginUserId")},a=function(t){var a=t.object.obtainUser;$.saveUserInfo(t.object.obtainUser),$("#realName").val(a.realName),$("#idCard").val(a.idCard),$("#idCardImgEmblemUploadPopupLink .img-icon").removeClass("img-camera").addClass("img-camera-active"),$("#idCardImgEmblem").val(a.idCardImgEmblem),$("#idCardImgEmblemPreview").append('<img src="'+a.idCardImgEmblem+"?"+Number(new Date)+"\" onerror=\"$('#idCardImgEmblem').attr('data-uploaded', '0');\">"),$("#idCardImgHeadUploadPopupLink .img-icon").removeClass("img-camera").addClass("img-camera-active"),$("#idCardImgHead").val(a.idCardImgHead),$("#idCardImgHeadPreview").append('<img src="'+a.idCardImgHead+"?"+Number(new Date)+"\" onerror=\"$('#idCardImgHead').attr('data-uploaded', '0');\">"),$("#idCardImgManUploadPopupLink .img-icon").removeClass("img-camera").addClass("img-camera-active"),$("#idCardImgMan").val(a.idCardImgMan),$("#idCardImgManPreview").append('<img src="'+a.idCardImgMan+"?"+Number(new Date)+"\" onerror=\"$('#idCardImgMan').attr('data-uploaded', '0');\">"),$(".popup-link").on("click",function(){var t=$(this).attr("data-popup"),i=t,o=t+"_"+$.getCookie("loginUserId"),n="已实名"==$.realCheck($.getCookie("loginUserReal"),["tongdunHeadPic"])?1:0,r="../upload_img.html?imgType="+i+"&imgName="+o+"&originUrl="+a[t]+"&realTag="+n,l=parent.document.getElementById(t+"Frame").contentWindow.location.href;l.indexOf("init=1")!=-1&&$("#"+t+"Frame").attr("src",r),$.popup("#"+t+"UploadPopup"),e.checkWXRuntime()}),$(".close-popup").on("click",function(){var e=$(this).attr("data-popup"),t=parent.document.getElementById(e+"Frame").contentWindow.location.href;if(t.indexOf("viewUrl=")!=-1){t.split("viewUrl=")[1].split("&")[0];$("#"+e).attr("data-uploaded","1"),$("#"+e+"UploadPopupLink .img-icon").removeClass("img-camera").addClass("img-camera-active")}$.closeModal("#"+e+"UploadPopup")}),$.hideIndicator()},i=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/getObtainUser.htm",t,a,i);var o=$.realCheck($.getCookie("loginUserReal"),["tongdunHeadPic"]);"已实名"==o?$(".save-btn-container").remove():$(".save-btn-container").removeClass("hidden")},submitRealIdimg:function(){var e=this,t=function(){var e={type:"tongdunHeadPic",realName:$.trim($("#realName").val()),idCard:$.trim($("#idCard").val()),idCardImgEmblem:$.trim($("#idCardImgEmblem").val()),idCardImgHead:$.trim($("#idCardImgHead").val()),idCardImgMan:$.trim($("#idCardImgMan").val())},t=function(e){"fail"==e.status?($.hideIndicator(),$.alert("实名认证未通过"),console.info(e.message)):($.hideIndicator(),$.alert("实名认证通过"),$.setCookie("loginUserReal",e.object,3600),$(".save-btn-container").remove())},a=function(e){$.alert("网络连接出错<br>请稍后重试"),$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/verifyObtainUser.htm",e,t,a)};e.submitValidation(t)},submitValidation:function(e){var t=$.trim($("#realName").val()),a=$.trim($("#idCard").val()),i=$("#idCardImgEmblem").attr("data-uploaded"),o=$("#idCardImgHead").attr("data-uploaded"),n=$("#idCardImgMan").attr("data-uploaded");return""==t?($.toast("请先在个人资料中完善“真实姓名”！",750),!1):""==a?($.toast("请先在个人资料中完善“身份证号”！",750),!1):"0"==i?($.toast("请上传身份证照A面！",750),!1):"0"==o?($.toast("请上传身份证照B面！",750),!1):"0"==n?($.toast("请上传手持身份证照片！",750),!1):void $.confirm("证件照是否清晰将会影响实名认证结果<br>确认提交？",function(){e()})},checkWXRuntime:function(){var e=window.navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)&&($.alert('<div style="font-size:0.85em;">图片上传功能在微信内置浏览器存在问题<br>请打开右上角菜单用其他浏览器打开</div>'),!0)}},realBankcardPage={init:function(){this.realInfoInit(),this.bankListInit(),this.domListener()},domListener:function(){var e=this;$("#saveInfoBtn").on("click",function(){e.submitRealBankcard()}),$("#bankSelectPopupLink").on("click",function(){$.popup("#bankSelectPopup")}),$("#bankSelectContainer").on("click",".item-link",function(){var e=$(this).attr("data-bankid"),t=$(this).find(".item-title").text(),a=$(this).attr("data-abbr");$("#bankId").val(e),$("#bankName").val(t),$("#bankAbbr").val(a),$.closeModal("#bankSelectPopup")})},realInfoInit:function(){var e={mobile:$.getCookie("loginUserMobile"),password:$.getCookie("loginUserPassword"),userId:$.getCookie("loginUserId")},t=function(e){var t=e.object.obtainUser;$.saveUserInfo(e.object.obtainUser);for(var a in t)$("#"+a)&&t[a]&&$("#"+a).val(t[a]);var i=$.realCheck(t.realCheck,["tongdunBankCard"]);"已实名"==i?$(".save-btn-container").remove():($.alert("输入的银行卡将作为还款代扣卡<br>请确认"),$(".save-btn-container").removeClass("hidden")),$.hideIndicator()},a=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/getObtainUser.htm",e,t,a)},submitRealBankcard:function(){var e=this,t=function(){var e={type:"tongdunBankCard",realName:$.trim($("#realName").val()),idCard:$.trim($("#idCard").val()),bankId:$.trim($("#bankId").val()),bankName:$.trim($("#bankName").val()),bankCardNum:$.trim($("#bankCardNum").val())},t=function(e){"fail"==e.status?($.hideIndicator(),$.alert("实名认证未通过"),console.info(e.message)):($.hideIndicator(),$.alert("实名认证通过",function(){$.setCookie("loginUserReal",e.object,3600),$(".save-btn-container").remove(),$.router.back()})),$.hideIndicator()},a=function(e){$.hideIndicator(),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/verifyObtainUser.htm",e,t,a)};e.submitValidation(t)},submitValidation:function(validationCallbackFunc){var bankCardNum=$.trim($("#bankCardNum").val()),realName=$.trim($("#realName").val()),idCard=$.trim($("#idCard").val()),bankId=$.trim($("#bankId").val()),bankAbbr=$.trim($("#bankAbbr").val()),bankCardNumReg=/^(\d{16}|\d{17}|\d{18}|\d{19})$/;if(""==realName)return $.toast("请先在个人资料中完善“真实姓名”！",750),!1;if(""==idCard)return $.toast("请先在个人资料中完善“身份证号”！",750),!1;if(!bankId)return $.toast("请选择银行卡号所属银行！",750),!1;if(!bankCardNumReg.test(bankCardNum))return $.toast("银行卡号填写有误！",750),!1;if(!bankCardNum)return $.toast("请填写银行卡号！",750),!1;var ajaxUrl=defaultConfig.domain+defaultConfig.project+"/creditUser/validateAndCacheCardInfo.htm",jsonData={cardNo:bankCardNum},successFunc=function(data){$.hideIndicator(),"fail"==data.status?($.alert("银行卡核验时出错<br>请稍后重试"),console.info(data.message)):(eval("var result = "+data.object),result.bank==bankAbbr?$.confirm("银行卡号是否填写正确将会影响实名认证结果<br>确认提交？",function(){validationCallbackFunc()}):$.alert("输入的银行卡号和选择的所属银行不匹配<br>请核对后再提交"))},failFunc=function(e){$.hideIndicator(),$.alert("银行卡核验时出错<br>请稍后重试"),console.info(e)};$.showIndicator(),$.ajaxAction(ajaxUrl,jsonData,successFunc,failFunc)},bankListInit:function(){var e=function(e){if("fail"==e.status)$.alert(e.message),console.info(e);else{for(var t=e.object,a="<ul>",i=0,o=t.length;i<o;i++){var n=t[i],r=!!n.baopay&&JSON.parse(n.baopay);r&&1==r.baoPay&&(a+='<li class="item-content item-link" data-abbr="'+n.abbreviation+'" data-bankid="'+n.bankId+'"><div class="item-inner"><div class="item-title">'+n.bankName+"</div></div></li>")}a+="</ul>",$("#bankSelectContainer").empty().append(a)}},t=function(e){$.alert("网络连接出错<br>请稍后重试"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/getCommonBankInfo.htm",{},e,t)}},creditMobilePage={init:function(){this.creditMobileInit(),this.domListener()},domListener:function(){var e=this;$("#authorizeBtn").on("click",function(){$(this).hasClass("init")?$.toast("验证码发送中，请等待...",750):$(this).hasClass("second-authorize")?$.prompt("部分城市（或手机号）需要进行二次验证<br>请输入第二次收到的验证码",function(t){t?e.secondAuthorizeMobile(jsonData.taskId,t):$.toast("请输入第二次收到的验证码！")}):e.authorizeMobile()}),$("#unauthorizeBtn").on("click",function(){e.unauthorizeMobile()}),$("#requestCodeBtn").on("click",function(){e.countFunc("#requestCodeBtn"),e.getMobileCode()}),$("#tipsPopupLink").on("click",function(){e.viewTips()})},creditMobileInit:function(){var e=!!$.getCookie("loginUserName"),t=!!$.getCookie("loginUserIdCard");return e&&t?void $("#mobile").val($.getCookie("loginUserMobile")):($.alert("实名信息未完善，无法进行运营商授权！",function(){$.router.back()}),!1)},getMobileCode:function(){var e=this;if(!e.submitValidation())return!1;var t={mobile:$.trim($("#mobile").val()),password:$.trim($("#password").val())},a=function(t){if("fail"==t.status)"任务已存在，创建失败！"==t.message?$.alert("已进行授权<br>请耐心等待后台审核结果"):($.alert(t.message),console.info(t.message));else{var a=t.object.task_id;$.toast("服务商验证码已发送，请查收"),$("#taskId").val(a),e.getTaskStatus(a)}},i=function(e){$.alert("网络连接出错，请稍后重试"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/moxie/carrier/createTask.htm",t,a,i)},getTaskStatus:function(e){var t={taskId:e},a=function(e){e.object.input?(clearInterval(n),"sms"==e.object.input.type?$("#authorizeBtn").removeClass("init"):$.toast("图片验证码正在努力中")):e.object.finished&&(clearInterval(n),$.alert("已进行授权<br>请耐心等待授权结果",function(){$.router.back()}))},i=function(e){$.alert("网络连接出错，请稍后重试"),console.info(e)},o=function(){$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/moxie/carrier/getTaskStatus.htm",t,a,i)},n=setInterval(function(){o()},1e3)},authorizeMobile:function(){var e=this;if(!e.submitValidation())return!1;if(!$.trim($("#verifyCode").val()))return $.toast("请填写手机获取到的验证码",750),!1;var t={taskId:$("#taskId").val(),code:$("#verifyCode").val()},a=function(t){"fail"==t.status?($.alert("授权失败<br>"+t.message),console.info(t)):($.showIndicator(),e.secondGetTaskStatus())},i=function(e){$.alert("网络连接错误，请稍后重试"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/moxie/carrier/input.htm",t,a,i)},secondGetTaskStatus:function(e){var t=this,a={taskId:$("#taskId").val()},i=function(e){e.object.can_leave?(clearInterval(r),$.hideIndicator(),$.alert("已进行授权<br>请耐心等待授权结果",function(){$.router.back()})):e.object.description.indexOf("二次")!=-1&&e.object.input&&(clearInterval(r),$.hideIndicator(),"sms"==e.object.input.type?($("#authorizeBtn").addClass("second-authorize"),$.prompt("部分城市（或手机号）需要进行二次验证<br>请输入第二次收到的验证码",function(e){e?t.secondAuthorizeMobile(a.taskId,e):$.toast("请输入第二次收到的验证码！")})):$.toast("图片验证码正在努力中"))},o=function(e){$.alert("网络连接出错，请稍后重试"),console.info(e)},n=function(){$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/moxie/carrier/getTaskStatus.htm",a,i,o)},r=setInterval(function(){n()},1e3)},secondAuthorizeMobile:function(e,t){var a={taskId:e,code:t},i=function(e){"fail"==e.status?($.alert("授权失败<br>"+e.message),console.info(e)):$.alert("已进行授权<br>请耐心等待授权结果",function(){$.router.back()})},o=function(e){$.alert("网络连接错误，请稍后重试"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/moxie/carrier/input.htm",a,i,o)},unauthorizeMobile:function(){var e=this;return!!e.submitValidation()&&void $.toast("取消授权功能完善中...",750)},submitValidation:function(){var e=$.trim($("#mobile").val()),t=$.trim($("#password").val()),a=/^1[34578]\d{9}$/;return""==e?($.toast("手机号不能为空！",750),!1):a.test(e)?""==t?($.toast("密码不能为空！",750),!1):6==t.length||($.toast("运营商密码长度为6位！",750),!1):($.toast("手机号填写有误！",750),!1)},countFunc:function(e){var t=$(e),a=59,i=setInterval(function(){t.text("("+a+"s)"),a--<=0&&(clearInterval(i),t.text("重新发送").removeClass("click-ban"))},1e3);t.addClass("click-ban"),t.text("(60s)")},viewTips:function(){$.popup("#tipsPopup")}},customer={indexPage:indexPage,loanFormPage:loanFormPage,repayBillPerPage:repayBillPerPage,repayRecordPage:repayRecordPage,repayDetailPage:repayDetailPage,repayBillAllPage:repayBillAllPage,userInfoPage:userInfoPage,editUserPage:editUserPage,loanPage:loanPage,orderPage:orderPage,orderDetailPage:orderDetailPage,creditManagementPage:creditManagementPage,realInfoPage:realInfoPage,realMobilePage:realMobilePage,realIdimgPage:realIdimgPage,realBankcardPage:realBankcardPage,creditMobilePage:creditMobilePage};window.customer=customer,$(document).on("pageInit",function(){router.setPage()}),$.init();