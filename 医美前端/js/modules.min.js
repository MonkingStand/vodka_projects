var defaultConfig={domain:"http://"+document.URL.split("/")[2],project:""};(function($){$.loadJsFiles=function(e){for(var t=0,a=e.length;t<a;t++){var o=Date.parse(new Date),i=document.createElement("script");i.src=e[t]+"?"+o,document.body.appendChild(i)}},$.radioModal=function(e,t){for(var a=e,t=t,o=t.textArr.length,i="",r='<ul class="radio-list">',n=0;n<o;n++)i=t.selectedIndex==n?"checked":"",r+='<li><label class="label-checkbox"><div class="item-inner"><div class="item-title-row"><div class="item-title">'+t.textArr[n]+'</div></div><input type="radio" name="test" value="'+t.valArr[n]+'" '+i+'><div class="item-media"><i class="selected-icon"></i></div></div></label></li>';r+="</ul>",$.modal({extraClass:"radio-modal",text:r}),$(".radio-modal label").on("click",function(){var e=$(this).find("input").val(),t=$(this).find(".item-title").text();a.find("span.radio-val").attr("data-val",e).text(t),a.find("input.radio-val").attr("data-val",e).val(t),$.closeModal()}),$(".modal-overlay-visible").on("click",function(){$.closeModal()})},$.ajaxAction=function(e,t,a,o){$.ajax({url:e,type:"post",dataType:"json",data:t,success:function(e){a(e)},error:function(e){o(e)}})},$.uploadImg={init:function(){this.checkUploadStatus(),this.domListener()},domListener:function(){var e=this;$(".upload-img-page").on("click",".img-input",function(){$.showIndicator(),setTimeout(function(){$.hideIndicator()},250)}).on("change",".img-input",function(t){var a=t.target.files[0],o=parseInt(a.size/1024);$.showIndicator(),e.imgPreview(a,o),$(this).closest(".upload-img-page").find(".upload-status").removeClass("init has-uploaded").addClass("not-uploaded")}),$(".upload-img-page .save-btn").on("click",function(){var t=$.getParameter("imgType"),a=$.getParameter("imgName");e.uploadImg(t,a)})},checkUploadStatus:function(){var e=Boolean(parseInt($.getParameter("realTag"))),t=Boolean(parseInt($.getParameter("uploaded"))),a=$.getParameter("viewUrl"),o=$.getParameter("originUrl");t?($(".upload-img-page .img-container").removeClass("not-uploaded").append('<img class="tmp-upload" src="'+a+"?"+Number(new Date)+'">'),$(".upload-img-page .upload-status").removeClass("init not-uploaded").addClass("has-uploaded")):$(".upload-img-page .img-container").removeClass("not-uploaded").append('<img class="tmp-upload" src="'+o+"?"+Number(new Date)+"\" onerror=\"$('.upload-img-page .img-container').addClass('not-uploaded');$('.tmp-upload').remove()\">"),e&&$(".operate-container").remove()},imgPreview:function(e,t){var a=this;EXIF.getData(e,function(){var o=EXIF.pretty(this),i=/(Orientation\s*:\s*\d)/,r=0;Boolean($.trim(o))&&Boolean(o.match(i))&&(r=$.trim(o.match(i)[1].split(":")[1])),$("#uploadForm").attr("data-orientation",r);var n=document.createElement("img");n.classList.add("tmp-upload"),n.setAttribute("id","tmpUploadImg"),n.file=e;var s=new FileReader;s.onload=function(e){return function(o){e.src=o.target.result,imgSrc=e.src,a.resizeImg(t,o)}}(n),s.readAsDataURL(e),$(".upload-img-page .img-container .tmp-upload").remove(),$(".upload-img-page .img-container").removeClass("not-uploaded"),$(".upload-img-page .img-container").append(n)})},resizeImg:function(e,t){var a=this;if(!(e>1024))return delete blob,$("#uploadForm").removeClass("to-resize"),setTimeout(function(){$.hideIndicator(),$(".upload-img-page .save-btn").removeClass("click-ban")},1e3),!1;$("#uploadForm").addClass("to-resize").attr("data-size",e/1024);var o=document.getElementById("resizeCanvas"),i=o.getContext("2d"),r=new Image;r.src=t.target.result,r.onload=function(){var e=r.width,t=r.height,n=e>t?e/1e3:t/1e3,s=parseInt($("#uploadForm").attr("data-orientation"));if(3==s||4==s||6==s||8==s){var l;3==s||4==s?l=Math.PI:6==s?l=Math.PI/2:8==s&&(l=1.5*Math.PI),o.setAttribute("width",t/n),o.setAttribute("height",e/n),i.save(),i.translate(500,500),i.rotate(l),e>t?i.drawImage(r,-500,500-t/n,e/n,t/n):i.drawImage(r,500-e/n,-500,e/n,t/n),i.restore()}else o.setAttribute("width",e/n),o.setAttribute("height",t/n),i.drawImage(r,0,0,e/n,t/n);var d=o.toDataURL("image/jpg",.75);window.blob=a.dataURItoBlob(d),setTimeout(function(){$.hideIndicator(),$(".upload-img-page .save-btn").removeClass("click-ban")},1e3)}},dataURItoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(t.length),i=0;i<t.length;i++)o[i]=t.charCodeAt(i);return new Blob([o],{type:a})},uploadImg:function(e,t){var a={ossPath:e},o=function(a){var o=a.object,i=document.URL;if(i.indexOf("init=1")!=-1&&(i=i.replace("init=1","init=0")),i.indexOf("uploaded")==-1&&(i+="&uploaded=1"),i.indexOf("viewUrl")==-1&&(i+="&viewUrl="+o.ossReadDomain+"/"+e+"/"+t+".jpg"),"fail"==a.status)$.hideIndicator(),$.alert("上传功能初始化失败<br>请稍后重试");else{var r=1;if($.getCookie("uploadBackTime")&&"0"!=$.getCookie("uploadBackTime")&&(r=parseInt($.getCookie("uploadBackTime"))+1),$.setCookie("uploadBackTime",r,3600),$("#uploadForm").hasClass("to-resize")){var n=parseFloat($("#uploadForm").attr("data-size"))/2;$("#stableTag").prop("checked")&&(n*=10);var s=new FormData;s.append("OSSAccessKeyId",o.accessid),s.append("policy",o.policy),s.append("Signature",o.signature),s.append("key",o.dir+t+".jpg"),s.append("success_action_redirect",i),s.append("file",blob),setTimeout(function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){setTimeout(function(){window.location.href=i},1e3*Math.ceil(n))},e.open("POST",o.host,!0),e.send(s)},1e3)}else $('input[name="OSSAccessKeyId"]').val(o.accessid),$('input[name="policy"]').val(o.policy),$('input[name="Signature"]').val(o.signature),$('input[name="key"]').val(o.dir+t+".jpg"),$('input[name="success_action_redirect"]').val(i),setTimeout(function(){$("#uploadForm").attr("action",o.host).submit()},500)}},i=function(e){$.alert("上传功能暂不可用<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/oss/signBeforePutObject.htm",a,o,i)}},$.qrGenerate=function(e,t,a,o){var i,r=e.querySelector("img");r&&e.removeChild(r),i=new QRCode(e,{width:a,height:a}),i.makeCode(t);var n=setInterval(function(){var t=e.querySelector("img");t&&(clearInterval(n),o())},750)},$.getParameter=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?decodeURI(a[2]):null},$.setCookie=function(e,t,a){var o="",i=a?1e3*a:0;if(0!=i){var r=new Date;r.setTime(r.getTime()+i),o="; expires="+r.toGMTString()}document.cookie=e+"="+escape(t)+o+"; path=/"},$.getCookie=function(e){for(var t=e+"=",a=document.cookie.split(";"),o=0;o<a.length;o++){for(var i=a[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return unescape(i.substring(t.length,i.length))}return!1},$.clearCookie=function(e){$.setCookie(e,"",-1)},$.saveUserInfo=function(e){$.setCookie("loginUserId",e.userId,3600),$.setCookie("loginUserName",e.realName?e.realName:"--",3600),$.setCookie("loginUserMobile",e.mobile,3600),$.setCookie("loginUserPassword",e.password,3600),$.setCookie("loginUserReal",e.realCheck,3600),$.setCookie("loginUserRole",e.role,3600),$.setCookie("loginUserSex",e.sex,3600),$.setCookie("loginUserIdCard",e.idCard,3600),"1"!=e.role&&($.setCookie("loginMerchantNo",e.merchantNo?e.merchantNo:"--",3600),$.setCookie("loginMerchantName",e.merchantName?e.merchantName:"--",3600),$.setCookie("loginLoanType",e.creditType?e.creditType:"",3600))},$.formatTime=function(e,t){var a=String(e).indexOf("-")==-1&&String(e).indexOf(".")==-1?parseInt(e):e,o=new Date(a),i=1==String(parseInt(o.getMonth())+1).length?"0"+(parseInt(o.getMonth())+1):parseInt(o.getMonth())+1,r=1==String(parseInt(o.getDate())).length?"0"+parseInt(o.getDate()):parseInt(o.getDate()),n=o.getFullYear()+"-"+i+"-"+r,s=1==String(o.getHours()).length?"0"+o.getHours():o.getHours(),l=1==String(o.getMinutes()).length?"0"+o.getMinutes():o.getMinutes(),d=1==String(o.getSeconds()).length?"0"+o.getSeconds():o.getSeconds(),c=s+":"+l+":"+d;return t&&"full"==t?n+" "+c:n},$.realCheck=function(realCheckStr,resultType){if(Boolean(realCheckStr)){if("-1"==realCheckStr.indexOf("{")&&(realCheckStr="{"+realCheckStr+"}"),eval("var realObj = "+realCheckStr),Boolean(resultType)){for(var result="已实名",i=0;i<resultType.length;i++)if(!Boolean(parseInt(realObj[resultType[i]]))){result="未实名";break}return result}var result="已实名";for(var key in realObj)if(!Boolean(parseInt(realObj[key]))){result="未实名";break}return result}return"未实名"},$.orderStatusTrans=function(e){var t="";switch(parseInt(e)){case 0:t="未提交";break;case 2:t="待审核";break;case 3:t="审核未通过";break;case 4:t="待审批";break;case 5:t="借款审批未通过";break;case 1:t="借款详情待确认";break;case 6:t="财务未放款";break;case 7:t="财务已放款";break;case 8:t="已退单";break;case 9:t="已退单";break;case 10:t="已退单"}return t}})(Zepto),window.defaultConfig=defaultConfig;