var wechatRegisterPage={init:function(){this.checkRegister(),this.domListener()},domListener:function(){var t=this;$("#bindLink").on("click",function(){window.location.href=defaultConfig.domain+defaultConfig.project+"/html/bind_wechat.html"}),$(".register-btn-container .button").on("click",function(){var e={mobile:$.trim($("#mobile").val()),password:$.trim($("#password").val()),wechatOpenId:$.trim($("#openId").val()),role:1,realName:"",realCheck:0,idCard:"",bankName:"",bankCardNum:""},o=function(t){"success"==t.status?($.hideIndicator(),$.toast("注册成功，即将跳转"),$.saveUserInfo(t.object),setTimeout(function(){var t=defaultConfig.domain+defaultConfig.project+"/html/customer/index.html";window.location.href=t},1e3)):($.alert(t.message),$.hideIndicator())},i=function(t){$.hideIndicator(),$.alert("注册失败<br>请稍后重试")};return!!t.registerValidation()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/insertCreditObtainUser.htm",e,o,i),void $.showIndicator())}),$("#requestCodeBtn").on("click",function(){var e=$.trim($("#mobile").val()),o=/^1[34578]\d{9}$/;return""==e?($.toast("未填写手机号,无法发送验证码！",750),!1):o.test(e)?void t.requestCode():($.toast("手机号填写有误！",750),!1)})},registerValidation:function(){var t=$.trim($("#mobile").val()),e=$.trim($("#password").val()),o=$.trim($("#pwdConfirm").val()),i=$.trim($("#verifyCode").val()),n=/^1[34578]\d{9}$/;return""==t?($.toast("手机号不能为空！",750),!1):n.test(t)?""==e?($.toast("密码不能为空！",750),!1):""==o?($.toast("请填写确认密码！",750),!1):e!=o?($.toast("两次输入的密码不一致！",750),!1):""==i?($.toast("请填写验证码！",750),!1):$.getCookie("mobileVerifyCode")?i==$.getCookie("mobileVerifyCode")||($.toast("验证码错误！",750),!1):($.toast("验证码已过期，请重新获取！",750),!1):($.toast("手机号填写有误！",750),!1)},requestCode:function(){var t=$("#requestCodeBtn"),e=function(){var e=59,o=setInterval(function(){t.text("("+e+"s)"),e--<=0&&(clearInterval(o),t.text("重新发送").removeClass("click-ban"))},1e3);t.text("(60s)")},o=function(){var t={mobile:$.trim($("#mobile").val())},e=function(t){$.setCookie("mobileVerifyCode",t.object.code,60)},o=function(t){$.toast("短信发送失败，请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/smsUtil/getCode.htm",t,e,o)};t.addClass("click-ban"),$.getCookie("mobileVerifyCode")||o(),e()},checkRegister:function(){var t=this,e={code:$.getParameter("code")},o=function(e){$.setCookie("wechatOpenId",e.object.openid,3600);var o={openId:e.object.openid},i=function(e){if("success"==e.status){var o={mobile:e.object.mobile,password:e.object.password,role:1};t.userLogin(o)}else $.hideIndicator(),$(".page").removeClass("invisible")},n=function(t){$.alert("网络连接错误<br>请稍后重试")};$.showIndicator(),$("#openId").val(e.object.openid),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/judgeRegist.htm",o,i,n)},i=function(t){$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/share/getwechatOpenId.htm",e,o,i)},userLogin:function(t){var e=function(t){"success"==t.status?($.saveUserInfo(t.object),setTimeout(function(){$.hideIndicator();var t=defaultConfig.domain+defaultConfig.project+"/html/customer/index.html";window.location.href=t},1e3)):$.alert(t.message)},o=function(t){$.alert("网络连接出错<br>请稍后重试!"),console.info(t)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",t,e,o)}},wechatBindPage={init:function(){this.domListener()},domListener:function(){var t=this;$("#bindBtn").on("click",function(){t.bindWechatOpenId()})},bindWechatOpenId:function(){var t=this,e={mobile:$.trim($("#mobileNumber").val()),password:$.trim($("#password").val()),wechatOpenId:$.getCookie("wechatOpenId")},o=function(t){"success"==t.status?($.saveUserInfo(t.object),$.hideIndicator(),$.alert("绑定成功",function(){window.location.href=defaultConfig.domain+defaultConfig.project+"/html/customer/index.html"})):($.hideIndicator(),$.alert(t.message))},i=function(t){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};return!!t.loginValidation()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/bindCreditUserOpenId.htm",e,o,i),void $.showIndicator())},loginValidation:function(){var t=$.trim($("#mobileNumber").val()),e=$.trim($("#password").val()),o=/^1[34578]\d{9}$/;return""==t?($.toast("手机号不能为空！",750),!1):o.test(t)?""!=e||($.toast("密码不能为空！",750),!1):($.toast("手机号填写有误！",750),!1)}},loginPage={init:function(){this.pageEffectsInit(),this.domListener()},domListener:function(){var t=this;$("#loginBtn").on("click",function(){var e={"用户":1,"咨询师":2},o={mobile:$.trim($("#mobileNumber").val()),password:$.trim($("#password").val()),role:e[$.trim($("#userType").val())]},i=function(t){"success"==t.status?($.hideIndicator(),$.toast("登录成功"),$.saveUserInfo(t.object),setTimeout(function(){var e="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html",o=("1"==t.object.role?"/customer":"/business")+"/index.html";window.location.href=e+o},1e3)):($.hideIndicator(),$.alert("用户名或者密码错误<br>请重试"))},n=function(t){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};return!!t.loginValidation()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/userLogin/userLogin.htm",o,i,n),void $.showIndicator())}),$("#registerLink").on("click",function(){var t="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/register.html";window.location.href=t})},pageEffectsInit:function(){var t='<header class="bar bar-nav"><button class="button button-link pull-right close-picker">确定</button><h1 class="title">请选择用户类型</h1></header>';$("#userType").picker({toolbarTemplate:t,cols:[{textAlign:"center",values:["用户","咨询师"]}]})},loginValidation:function(){var t=$.trim($("#mobileNumber").val()),e=$.trim($("#password").val()),o=$.trim($("#userType").val()),i=/^1[34578]\d{9}$/;return""==t?($.toast("手机号不能为空！",750),!1):i.test(t)?""==e?($.toast("密码不能为空！",750),!1):""!=o||($.toast("请选择用户类型！",750),!1):($.toast("手机号填写有误！",750),!1)}},registerPage={init:function(){this.domListener()},domListener:function(){var t=this;$(".register-btn-container .button").on("click",function(){var e={mobile:$.trim($("#mobile").val()),password:$.trim($("#password").val()),wechatOpenId:"",role:1,realName:"",realCheck:0,idCard:"",bankName:"",bankCardNum:""},o=function(t){"success"==t.status?($.hideIndicator(),$.toast("注册成功，即将跳转"),$.saveUserInfo(t.object),setTimeout(function(){var t="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/customer/index.html";window.location.href=t},1e3)):($.alert(t.message),$.hideIndicator())},i=function(t){$.hideIndicator(),$.alert("注册失败<br>请稍后重试")};return!!t.registerValidation()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/creditUser/insertCreditObtainUser.htm",e,o,i),void $.showIndicator())}),$("#requestCodeBtn").on("click",function(){var e=$.trim($("#mobile").val()),o=/^1[34578]\d{9}$/;return""==e?($.toast("未填写手机号,无法发送验证码！",750),!1):o.test(e)?void t.requestCode():($.toast("手机号填写有误！",750),!1)})},registerValidation:function(){var t=$.trim($("#mobile").val()),e=$.trim($("#password").val()),o=$.trim($("#pwdConfirm").val()),i=$.trim($("#verifyCode").val()),n=/^1[34578]\d{9}$/;return""==t?($.toast("手机号不能为空！",750),!1):n.test(t)?""==e?($.toast("密码不能为空！",750),!1):""==o?($.toast("请填写确认密码！",750),!1):e!=o?($.toast("两次输入的密码不一致！",750),!1):""==i?($.toast("请填写验证码！",750),!1):$.getCookie("mobileVerifyCode")?i==$.getCookie("mobileVerifyCode")||($.toast("验证码错误！",750),!1):($.toast("验证码已过期，请重新获取！",750),!1):($.toast("手机号填写有误！",750),!1)},requestCode:function(){var t=$("#requestCodeBtn"),e=function(){var e=59,o=setInterval(function(){t.text("("+e+"s)"),e--<=0&&(clearInterval(o),t.text("重新发送").removeClass("click-ban"))},1e3);t.text("(60s)")},o=function(){var t={mobile:$.trim($("#mobile").val())},e=function(t){$.setCookie("mobileVerifyCode",t.object.code,60)},o=function(t){$.toast("短信发送失败，请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/smsUtil/getCode.htm",t,e,o)};t.addClass("click-ban"),$.getCookie("mobileVerifyCode")||o(),e()}},merchantRegisterPage={init:function(){this.domListener()},domListener:function(){var t=this;$(".register-btn-container .button").on("click",function(){var e=$.getParameter("merchantNo"),o=$.getParameter("role"),i={mobile:$.trim($("#mobile").val()),password:$.trim($("#password").val()),merchantNo:e,role:o},n=function(t){"success"==t.status?($.hideIndicator(),$.toast("注册成功，即将跳转"),$.saveUserInfo(t.object),setTimeout(function(){var t=defaultConfig.domain+defaultConfig.project+"/html/business/index.html";window.location.href=t},1e3)):($.alert(t.message),$.hideIndicator())},a=function(t){$.hideIndicator(),$.alert("注册失败<br>请稍后重试")};return!!t.registerValidation()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/merchantUser/insertMerchantUser.htm",i,n,a),void $.showIndicator())}),$("#requestCodeBtn").on("click",function(){var e=$.trim($("#mobile").val());return""==e?($.toast("未填写手机号,无法发送验证码！",750),!1):void t.requestCode()})},registerValidation:function(){var t=$.trim($("#mobile").val()),e=$.trim($("#password").val()),o=$.trim($("#pwdConfirm").val()),i=$.trim($("#verifyCode").val()),n=/^1[34578]\d{9}$/;return""==t?($.toast("手机号不能为空！",750),!1):n.test(t)?""==e?($.toast("密码不能为空！",750),!1):""==o?($.toast("请填写确认密码！",750),!1):e!=o?($.toast("两次输入的密码不一致！",750),!1):""==i?($.toast("请填写验证码！",750),!1):i==$.getCookie("mobileVerifyCode")||($.toast("验证码错误！",750),!1):($.toast("手机号填写有误！",750),!1)},requestCode:function(){var t=$("#requestCodeBtn"),e=function(){var e=59,o=setInterval(function(){t.text("("+e+"s)"),e--<=0&&(clearInterval(o),t.text("重新发送").removeClass("click-ban"))},1e3);t.text("(60s)")},o=function(){var t={mobile:$.trim($("#mobile").val())},e=function(t){$.setCookie("mobileVerifyCode",t.object.code,60)},o=function(t){$.toast("短信发送失败，请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/smsUtil/getCode.htm",t,e,o)};t.addClass("click-ban"),$.getCookie("mobileVerifyCode")||o(),e()}};$(document).on("pageInit",function(){var t=$(".page").attr("id"),e={loginPage:loginPage,registerPage:registerPage,wechatRegisterPage:wechatRegisterPage,wechatBindPage:wechatBindPage,merchantRegisterPage:merchantRegisterPage};e[t].init()}),$.init();