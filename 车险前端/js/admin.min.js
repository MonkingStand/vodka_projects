var defaultConfig={domain:"http://"+document.URL.split("/")[2],project:"",ossPre:"http://znzzc-vodka-insurance-online.oss-cn-shanghai.aliyuncs.com"};(function(a){a.ajaxAction=function(e,t,n,r){a.ajax({url:e,type:"post",dataType:"json",data:t,success:function(a){n(a)},error:function(a){r(a)}})},a.formatTime=function(a,e){var t=String(a).indexOf("-")==-1&&String(a).indexOf(".")==-1?parseInt(a):a,n=new Date(t),r=1==String(parseInt(n.getMonth())+1).length?"0"+(parseInt(n.getMonth())+1):parseInt(n.getMonth())+1,i=1==String(parseInt(n.getDate())).length?"0"+parseInt(n.getDate()):parseInt(n.getDate()),o=n.getFullYear()+"-"+r+"-"+i,s=1==String(n.getHours()).length?"0"+n.getHours():n.getHours(),c=1==String(n.getMinutes()).length?"0"+n.getMinutes():n.getMinutes(),l=1==String(n.getSeconds()).length?"0"+n.getSeconds():n.getSeconds(),d=s+":"+c+":"+l;return e&&"full"==e?o+" "+d:o},a.autoFill=function(e,t){var n=1==arguments.length?"":t;if(e)for(var r in e)a("#"+n+r).val(e[r])},a.alert=function(e,t){var n=t?"<strong>"+t+"</strong>":"",r='<div class="alert alert-danger alert-dismissible customer-alert" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'+n+e+"</div>";a("body").append(r),setTimeout(function(){a(".customer-alert").remove()},2e3)},a.statusTrans=function(a){var e={0:'<span class="text-normal label label-primary">待获取保险公司报价</span>',1:'<span class="text-normal label label-warning">用户还未投保支付</span>',2:'<span class="text-normal label label-info">用户已投保支付（待录入保单号）</span>',3:'<span class="text-normal label label-success">投保成功（已录入保单号）</span>'};return e[String(a)]}})(jQuery);var pageEffectsInit=function(){$("#filterContainer a").on("click",function(a){a.preventDefault(),$(this).tab("show");var e=$(this).attr("data-detail"),t=$("#detailContainer").attr("data-detail");e!==t&&($("#detailContainer").attr("data-detail",e),$("#detailContainer .detail-content.active").removeClass("active").css("display","none"),$(e).addClass("active").fadeIn())}),$("#toGetPriceDetailPanelGroup").collapse(),$("#hasPayDetailPanelGroup").collapse(),$("#companyToggleContainer a").on("click",function(a){a.preventDefault(),$(this).tab("show")}),$(".form_datetime").datetimepicker({format:"yyyy-mm-dd",language:"zh-CN",autoclose:!0,minView:"month"})},ajaxListenerInit=function(){$("#orderListContent .tab-content").on("click",".order-item",function(){var a=$(this),e=a.closest(".tab-pane"),t=e.find(".order-item.active"),n=a.attr("data-orderno"),r=a.attr("data-ownerno"),i=a.attr("data-status"),o=e.attr("data-type"),s={toGetPrice:toGetPriceDetail,hasPay:hasPayDetail};$("#"+o+"Detail").find(".section-title .order-no").text(n),$("#"+o+"Detail").find(".section-title .status-container").empty().append($.statusTrans(i)),a.hasClass("active")||(t.removeClass("active"),a.addClass("active"),s[o](n,r))}),$(".save-price-btn").on("click",function(){var a=$("#toGetPriceList .order-item.active").attr("data-orderno"),e=$("#toGetPriceList .order-item.active").attr("data-ownerno"),t=$(this).attr("data-company"),n=$(this).attr("data-type"),r=$(this).closest(".tab-pane"),i=r.attr("id")+"_",o={amount:0},s=!0;if(r.find(".submit-input:not([disabled])").each(function(){var a=$(this).attr("id"),e=$(this).val();e&&"0"!=e?isNaN(e)||(o[a.replace(i,"")]=Number(e)):s=a===i+"promotionFee"&&s}),!s)return void $.alert("存在部分险种报价未填写，或者未填写交强险（商业险）的保单有效期起止时间！");o.promotionFee=o.promotionFee?Number(o.promotionFee):0;for(var c in o)"promotionFee"!==c&&(o.amount+=o[c]);if(o.sumPrem=o.amount-o.promotionFee,o.orderId=a,o.carOwnerInfoId=e,o.simpleNameEn=t,0===o.amount)return void $.alert("请录入当前选中保险公司的报价信息！");var l=$("#"+i+"tpfStartDate").val(),d=$("#"+i+"tpfEndDate").val(),u=$("#"+i+"bizStartDate").val(),f=$("#"+i+"bizEndDate").val();return o.tpfStartDate=l,o.tpfEndDate=d,o.bizStartDate=u,o.bizEndDate=f,o.amount=Number(parseFloat(o.amount).toFixed(2)),o.sumPrem=Number(parseFloat(o.sumPrem).toFixed(2)),o.bizPrem=Number(parseFloat($("#"+i+"bizPrem").val())),parseFloat(o.bizPrem+o.tpfPrem+o.taxPrem).toFixed(2)!=o.amount?void $.alert("录入的商业险价格和计算所得价格有误，请核对后再保存！"):void("count"==n?($("#"+i+"amount").val(o.amount),$("#"+i+"sumPrem").val(o.sumPrem)):savePricePerCompany(o))}),$("#finishPriceBtn").on("click",function(){var a={orderId:$("#toGetPriceList .order-item.active").attr("data-orderno")};finishPrice(a)}),$("#savePolicyNoBtn").on("click",function(){var a=$("#hasPayList .order-item.active").attr("data-orderno");savePolicyNo(a)})},toGetPriceListInit=function(){var a=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findQuotationNotCompleted.json",e={},t=function(a){var e="",t=a.object,n=t?t.length:0;if("fail"==a.status)$.alert(a.message);else if(0===n)$("#toGetPriceList").empty().addClass("no-order");else{for(var r=0;r<n;r++){var i=0===r?" active":"",o=t[r],s=o.orderId,c=o.carOwnerInfoId,l=o.payStatus,d=o.carOwner?o.carOwner:"--",u=o.licenseNo?o.licenseNo:"--",f=o.createTime?$.formatTime(o.createTime,"full"):"--";e+='<div class="order-item'+i+'" data-orderno="'+s+'" data-ownerno="'+c+'" data-status="'+l+'"><div class="row"><div class="col-xs-6"><i class="fa fa-user"></i>&nbsp;'+d+'</div><div class="col-xs-6 text-right"><i class="fa fa-car"></i>&nbsp;'+u+'</div><div class="col-xs-12 text-right"><i class="fa fa-calendar"></i>&nbsp;'+f+"</div></div></div>"}toGetPriceDetail(t[0].orderId,t[0].carOwnerInfoId),$("#toGetPriceDetail").find(".section-title .order-no").text(t[0].orderId),$("#toGetPriceDetail").find(".section-title .status-container").empty().append($.statusTrans(t[0].payStatus)),$("#toGetPriceList").empty().append(e)}},n=function(a){$.alert("获取【待录入报价订单】时网络连接出错，请稍后重试"),console.info(a)};$.ajaxAction(a,e,t,n)},toGetPriceDetail=function(a,e){var t=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findOrderDetail.json",n={orderId:a,carOwnerInfoId:e},r=function(a){if("fail"==a.status)$.alert(a.message);else{var e=a.object[0],t=a.object[1],n=a.object.slice(2);$.autoFill(e,"toGetPrice_carInfo_"),$.autoFill(t,"toGetPrice_userInfo_"),$("#toGetPrice_carInfo_newCarTag").val(1==$("#toGetPrice_carInfo_newCarTag").val()?"是":"否"),$("#toGetPrice_carInfo_transferFlag").val(1==$("#toGetPrice_carInfo_transferFlag").val()?"是":"否"),$("#toGetPrice_carInfo_createTime").val($.formatTime(e.enrollDate),"full"),o(),s(n)}},i=function(a){$.alert("获取【订单详情】时网络连接出错，请稍后重试"),console.info(a)},o=function(){$("#cpicCompany .submit-input").val(""),$("#pinganCompany .submit-input").val(""),$("#piccCompany .submit-input").val(""),$("#cpicCompany_promotionFee").val(0),$("#pinganCompany_promotionFee").val(0),$("#piccCompany_promotionFee").val(0)},s=function(a){for(var e=a.length,t={999:"tpfPrem",34:"premPlastic",36:"premNaturalLoss",A36:"premNaturalLossIndemnity",63:"premCarDamage",A63:"premCarDamageIndemnity",68:"premThirdDuty",A68:"premThirdDutyIndemnity",73:"premDriverSeat",A73:"premDriverSeatIndemnity",89:"premPassagerSeat",A89:"premPassagerSeatIndemnity",74:"premRobbery",A74:"premRobberyIndemnity",75:"premScratches"},n=0;n<e;n++){var r=a[n],i=r.kindCode,o=r.amount;"A"===i[0]&&"0"==o?$("#toGetPrice_insurance_"+i).val("不计免赔"):$("#toGetPrice_insurance_"+i).val(o),delete t[i]}$("#cpicCompany .submit-input").removeAttr("disabled"),$("#pinganCompany .submit-input").removeAttr("disabled"),$("#piccCompany .submit-input").removeAttr("disabled");for(var s in t)$("#cpicCompany_"+t[s]).attr("disabled","disabled"),$("#pinganCompany_"+t[s]).attr("disabled","disabled"),$("#piccCompany_"+t[s]).attr("disabled","disabled");if("不投保"!==$("#toGetPrice_insurance_999").val()&&$("#toGetPrice_insurance_999").val("投保"),"不投保"!==$("#toGetPrice_insurance_63").val()&&$("#toGetPrice_insurance_63").val("投保"),"不投保"!==$("#toGetPrice_insurance_74").val()&&$("#toGetPrice_insurance_74").val("投保"),"不投保"!==$("#toGetPrice_insurance_36").val()&&$("#toGetPrice_insurance_36").val("投保"),"不投保"!==$("#toGetPrice_insurance_34").val()){var c=1==$("#toGetPrice_insurance_34").val()?"国产":"进口";$("#toGetPrice_insurance_34").val(c)}"不投保"!==$("#toGetPrice_insurance_75").val()&&$("#toGetPrice_insurance_75").val("投保")};$("#toGetPrice_carAndInsuranceInfo .insurance_").val("不投保"),$("#toGetPrice_carAndInsuranceInfo .insuranceA").val("--"),$.ajaxAction(t,n,r,i)},savePricePerCompany=function(a){var e=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/insertQuotationInfo.json",t=function(e){"fail"==e.status?$.alert(e.message):$.alert(r[a.simpleNameEn]+"保存报价成功！")},n=function(a){$.alert("初始化保险公司报价的时候出错，请稍后重试"),console.info(a)},r={TAI_PING_YANG:"【太平洋保险】",PING_AN:"【中国平安】",REN_BAO:"【中国人民保险】"};return new Date(a.tpfStartDate)>=new Date(a.tpfEndDate)?void $.alert("交强险保单有效期【开始时间】不能大于或等于【结束时间】"):new Date(a.bizStartDate)>=new Date(a.bizEndDate)?void $.alert("商业险保单有效期【开始时间】不能大于或等于【结束时间】"):void $.ajaxAction(e,a,t,n)},finishPrice=function(a){var e=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/updateQuotationStatus.json",t=function(a){"fail"==a.status?$.alert(a.message):($.alert("完成报价"),setTimeout(function(){location.reload()},1500))},n=function(a){$.alert("提交报价的时候出错，请稍后重试"),console.info(a)};$.ajaxAction(e,a,t,n)},hasPayListInit=function(){var a=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findPaySuccessOrderList.json",e={},t=function(a){var e="",t=a.object,n=t?t.length:0;if("fail"==a.status)$.alert(a.message);else if(0===n)$("#hasPayList").empty().addClass("no-order");else{for(var r=0;r<n;r++){var i=0===r?" active":"",o=t[r],s=o.orderId,c=o.carOwnerInfoId,l=o.payStatus,d=o.carOwner?o.carOwner:"--",u=o.licenseNo?o.licenseNo:"--",f=o.createTime?$.formatTime(o.createTime,"full"):"--";e+='<div class="order-item'+i+'" data-orderno="'+s+'" data-ownerno="'+c+'" data-status="'+l+'"><div class="row"><div class="col-xs-6"><i class="fa fa-user"></i>&nbsp;'+d+'</div><div class="col-xs-6 text-right"><i class="fa fa-car"></i>&nbsp;'+u+'</div><div class="col-xs-12 text-right"><i class="fa fa-calendar"></i>&nbsp;'+f+"</div></div></div>"}hasPayDetail(t[0].orderId,t[0].carOwnerInfoId),$("#hasPayDetail").find(".section-title .order-no").text(t[0].orderId),$("#hasPayDetail").find(".section-title .status-container").empty().append($.statusTrans(t[0].payStatus)),$("#hasPayList").empty().append(e)}},n=function(a){$.alert("获取【已录入报价订单】时网络连接出错，请稍后重试"),console.info(a)};$.ajaxAction(a,e,t,n)},hasPayDetail=function(a,e){var t=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findOrderDetail.json",n={orderId:a,carOwnerInfoId:e},r=function(t){if("fail"==t.status)$.alert(t.message);else{var n=t.object[0],r=t.object[1],i=t.object.slice(2);$.autoFill(n,"hasPay_carInfo_"),$.autoFill(r,"hasPay_userInfo_"),$("#hasPay_carInfo_newCarTag").val(1==$("#hasPay_carInfo_newCarTag").val()?"是":"否"),$("#hasPay_carInfo_transferFlag").val(1==$("#hasPay_carInfo_transferFlag").val()?"是":"否"),$("#hasPay_carInfo_createTime").val($.formatTime(n.enrollDate),"full"),o(i),hasPayInsuranceDetail(a,r.carOwner,e)}},i=function(a){$.alert("获取【订单详情】时网络连接出错，请稍后重试"),console.info(a)},o=function(a){for(var e=a.length,t={999:"tpfPrem",34:"premPlastic",36:"premNaturalLoss",A36:"premNaturalLossIndemnity",63:"premCarDamage",A63:"premCarDamageIndemnity",68:"premThirdDuty",A68:"premThirdDutyIndemnity",73:"premDriverSeat",A73:"premDriverSeatIndemnity",89:"premPassagerSeat",A89:"premPassagerSeatIndemnity",74:"premRobbery",A74:"premRobberyIndemnity",75:"premScratches"},n=0;n<e;n++){var r=a[n],i=r.kindCode,o=r.amount;"A"===i[0]&&"0"==o?$("#hasPay_insurance_"+i).val("不计免赔"):$("#hasPay_insurance_"+i).val(o),delete t[i]}if("不投保"!==$("#hasPay_insurance_999").val()&&$("#hasPay_insurance_999").val("投保"),"不投保"!==$("#hasPay_insurance_63").val()&&$("#hasPay_insurance_63").val("投保"),"不投保"!==$("#hasPay_insurance_74").val()&&$("#hasPay_insurance_74").val("投保"),"不投保"!==$("#hasPay_insurance_36").val()&&$("#hasPay_insurance_36").val("投保"),"不投保"!==$("#hasPay_insurance_34").val()){var s=1==$("#hasPay_insurance_34").val()?"国产":"进口";$("#hasPay_insurance_34").val(s)}"不投保"!==$("#hasPay_insurance_75").val()&&$("#hasPay_insurance_75").val("投保")};$("#hasPay_carAndInsuranceInfo .insurance_").val("不投保"),$("#hasPay_carAndInsuranceInfo .insuranceA").val("--"),$.ajaxAction(t,n,r,i)},hasPayInsuranceDetail=function(a,e,t){var n=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findSuccessOrderInfo.json",r={orderId:a},i=function(a){if(console.info(a),"fail"==a.status)$.alert(a.message);else{var n=a.object[0];$.autoFill(n,"hasPay_insuranceInfo_"),$("#hasPay_insuranceInfo_carOwner").val(e);var r=parseFloat(n.sumPrem)+parseFloat(n.promotionFee);$("#hasPay_insuranceInfo_amount").val(r);var i=defaultConfig.ossPre;$("#idCardImgEmblem").attr("href",i+"/idCardImgEmblem/idCardImgEmblem_"+t+".jpg"),$("#idCardImgHead").attr("href",i+"/idCardImgHead/idCardImgHead_"+t+".jpg"),$("#drivingLicenseFirst").attr("href",i+"/drivingLicenseFirst/drivingLicenseFirst_"+t+".jpg"),$("#drivingLicenseSecond").attr("href",i+"/drivingLicenseSecond/drivingLicenseSecond_"+t+".jpg"),n.policyNo?$("#savePolicyNoBtn").addClass("click-ban"):$("#savePolicyNoBtn").removeClass("click-ban")}},o=function(a){$.alert("获取【投保信息】时网络连接出错，请稍后重试"),console.info(a)};$.ajaxAction(n,r,i,o)},savePolicyNo=function(a){var e=defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/insertPolicyNo.json",t={orderId:a,policyNo:$("#policyNo").val()},n=function(a){console.info("录入保单号",a),"fail"==a.status?$.alert(a.message):($.alert("录入保单号成功!"),setTimeout(function(){location.reload()},1e3))},r=function(a){$.alert("保存保单号时网络连接出错，请稍后重试"),console.info(a)};return t.policyNo?void $.ajaxAction(e,t,n,r):void $.alert("请输入保单号！")};pageEffectsInit(),ajaxListenerInit(),toGetPriceListInit(),hasPayListInit();