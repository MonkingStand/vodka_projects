var loginPage={init:function(){this.domListener()},domListener:function(){var e=this;$("#loginBtn").on("click",function(){e.loginFunc()}),$("#registerLink").on("click",function(){var e="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/register.html";window.location.href=e})},loginFunc:function(){var e=this,t={mobile:$("#mobile").val().trim(),password:$("#password").val().trim(),role:1},i=function(t){$.hideIndicator(),"fail"==t.status?$.alert(t.message):($.setCookie("pwd",$("#password").val().trim(),3600),e.linkTo(t.object))},n=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};e.submitValidation()&&($.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/login.json",t,i,n),$.showIndicator())},submitValidation:function(){var e=$("#mobile").val().trim(),t=$("#password").val().trim(),i=/^1[34578]\d{9}$/;return e?i.test(e)?!!t||($.toast("密码不能为空！",750),!1):($.toast("手机号填写有误！",750),!1):($.toast("手机号不能为空！",750),!1)},linkTo:function(e){$.hideIndicator(),$.toast("登录成功，即将跳转"),$.setCookie("userMobile",e.carOwnerInfoBak.mobile,3600),$.setCookie("userData",JSON.stringify(e.carOwnerInfoBak),3600),$.setCookie("orderData",JSON.stringify(e.vehicleOrderInfo),3600),setTimeout(function(){var t="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/";if(e.vehicleOrderInfo)switch(parseInt(e.vehicleOrderInfo.payStatus)){case 0:t+="wait_page.html";break;case 1:t+="new_insurance_price.html";break;case 2:t+="policy_no_wait.html";break;case 3:t+="success_page.html";break;case 4:t+="instalment_success.html";break;default:t+="new_insurance_info.html"}else t+="new_insurance_info.html";window.location.href=t},1e3)}},loginWechatPage={init:function(){this.wechatInfoInit(),this.domListener()},domListener:function(){var e=this;$("#getVerifyCodeBtn:not(.click-ban)").on("click",function(){e.getVerifyCode()}),$("#registerWechatBtn").on("click",function(){e.register()}),$("#bindWechatLink").on("click",function(){$.alert("请在公众号菜单栏【医美】中进行微信绑定")})},submitValidation:function(){var e=$.trim($("#mobile").val()),t=$.trim($("#password").val()),i=$.trim($("#verifyPassword").val()),n=$.trim($("#verifyCode").val()),a=/^1[34578]\d{9}$/;return""==e?($.toast("手机号不能为空！",750),!1):a.test(e)?""==t?($.toast("密码不能为空！",750),!1):""==i?($.toast("请填写确认密码！",750),!1):t!=i?($.toast("两次输入的密码不一致！",750),!1):""==n?($.toast("请填写验证码！",750),!1):$.getCookie("mobileVerifyCode")?n==$.getCookie("mobileVerifyCode")||($.toast("验证码错误！",750),!1):($.toast("验证码已过期，请重新获取！",750),!1):($.toast("手机号填写有误！",750),!1)},getVerifyCode:function(){var e=$("#getVerifyCodeBtn"),t=$.trim($("#mobile").val()),i=/^1[34578]\d{9}$/;if(""==t)return $.toast("手机号不能为空！",750),!1;if(!i.test(t))return $.toast("手机号填写有误！",750),!1;var n=function(){var t=59,i=setInterval(function(){e.text("("+t+"s)"),t--<=0&&(clearInterval(i),e.text("重新发送").removeClass("click-ban"))},1e3);e.text("(60s)")},a=function(){var e={mobile:$.trim($("#mobile").val())},t=function(e){$.setCookie("mobileVerifyCode",e.object,60)},i=function(e){$.toast("短信发送失败，请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/getCode.json",e,t,i)};e.addClass("click-ban"),$.getCookie("mobileVerifyCode")||a(),n()},register:function(){var e=this,t={mobile:$.trim($("#mobile").val()),password:$.trim($("#password").val()),wechatOpenId:$.trim($("#openId").val()),role:1,realName:"",realCheck:0,idCard:"",bankName:"",bankCardNum:""},i=function(i){"success"==i.status?e.loginFunc(t):($.alert(i.message),$.hideIndicator())},n=function(e){$.hideIndicator(),$.alert("注册失败<br>请稍后重试"),console.info(e)};e.submitValidation()&&($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/regist.json",t,i,n))},loginFunc:function(e){var t=function(t){"fail"==t.status?$.alert(t.message):($.hideIndicator(),$.setCookie("userMobile",e.mobile,3600),$.setCookie("pwd",e.password,3600),$.setCookie("userData",JSON.stringify(t.object.carOwnerInfoBak),3600),$.setCookie("orderData",JSON.stringify(t.object.vehicleOrderInfo),3600),setTimeout(function(){var e="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/new_insurance_info.html";window.location.href=e},1e3))},i=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/login.json",e,t,i)},wechatInfoInit:function(){var e=this,t={code:$.getParameter("wxcode")},i=function(t){$.setCookie("wechatOpenId",t.object.openid,3600);var i={openId:t.object.openid},n=function(t){if("success"==t.status){var i={mobile:t.object.mobile,password:t.object.password,role:1};e.loginFunc(i)}else $.hideIndicator(),$(".page").removeClass("invisible")},a=function(e){$.alert("网络连接错误<br>请稍后重试")};$.showIndicator(),$("#openId").val(t.object.openid),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/judgeRegist.json",i,n,a)},n=function(e){$.alert("网络连接错误<br>请稍后重试")};t.code?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/getwechatOpenId.json",t,i,n)):$.alert("请通过公众号打开此链接！")}},registerPage={init:function(){this.domListener()},domListener:function(){var e=this;$("#getVerifyCodeBtn:not(.click-ban)").on("click",function(){e.getVerifyCode()}),$("#registerBtn").on("click",function(){e.register()}),$("#loginLink").on("click",function(){var e="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/login.html";window.location.href=e})},submitValidation:function(){var e=$.trim($("#mobile").val()),t=$.trim($("#password").val()),i=$.trim($("#verifyPassword").val()),n=$.trim($("#verifyCode").val()),a=/^1[34578]\d{9}$/;return""==e?($.toast("手机号不能为空！",750),!1):a.test(e)?""==t?($.toast("密码不能为空！",750),!1):""==i?($.toast("请填写确认密码！",750),!1):t!=i?($.toast("两次输入的密码不一致！",750),!1):""==n?($.toast("请填写验证码！",750),!1):$.getCookie("mobileVerifyCode")?n==$.getCookie("mobileVerifyCode")||($.toast("验证码错误！",750),!1):($.toast("验证码已过期，请重新获取！",750),!1):($.toast("手机号填写有误！",750),!1)},getVerifyCode:function(){var e=$("#getVerifyCodeBtn"),t=$.trim($("#mobile").val()),i=/^1[34578]\d{9}$/;if(""==t)return $.toast("手机号不能为空！",750),!1;if(!i.test(t))return $.toast("手机号填写有误！",750),!1;var n=function(){var t=59,i=setInterval(function(){e.text("("+t+"s)"),t--<=0&&(clearInterval(i),e.text("重新发送").removeClass("click-ban"))},1e3);e.text("(60s)")},a=function(){var e={mobile:$.trim($("#mobile").val())},t=function(e){$.setCookie("mobileVerifyCode",e.object,60)},i=function(e){$.toast("短信发送失败，请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/getCode.json",e,t,i)};e.addClass("click-ban"),$.getCookie("mobileVerifyCode")||a(),n()},register:function(){var e=this,t={mobile:$.trim($("#mobile").val()),password:$.trim($("#password").val()),role:1},i=function(i){"success"==i.status?e.loginFunc(t):($.alert(i.message),$.hideIndicator())},n=function(e){$.hideIndicator(),$.alert("注册失败<br>请稍后重试"),console.info(e)};e.submitValidation()&&($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/regist.json",t,i,n))},loginFunc:function(e){var t=function(t){"fail"==t.status?$.alert(t.message):($.hideIndicator(),$.toast("注册成功，即将跳转"),$.setCookie("userMobile",e.mobile,3600),$.setCookie("pwd",e.password,3600),$.setCookie("userData",JSON.stringify(t.object.carOwnerInfoBak),3600),$.setCookie("orderData",JSON.stringify(t.object.vehicleOrderInfo),3600),setTimeout(function(){var e="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/new_insurance_info.html";window.location.href=e},1e3))},i=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/login.json",e,t,i)}},newInsuranceInfoPage={init:function(){this.provinceListInit(),this.domListener()},domListener:function(){var e=this;$.singleRadio(),$(".popup-link").on("click",function(){$.popup($(this).attr("data-popup"))}),$("#citySelectPopup #cityListContainer").on("click",".province-item",function(){e.cityItemInit($(this))}).on("click",".city-item",function(){e.cityFill($(this))}),$("#newInsuranceInfoPage .step-link-container .button").on("click",function(){e.linkToNext()})},provinceListInit:function(){var e={},t=function(e){for(var t=e.object,i=t.length,n="",a=0;a<i;a++){var o=t[a];n+='<li class="list-group-title province-item init" data-code="'+o.placeCode+'">'+o.placeFullName+'<i class="icon icon-right pull-right"></i></li>',n+='<div id="province'+o.placeCode+'" class="city-list-content"></div>'}$("#cityListContainer").empty().append(n)},i=function(e){$.alert("获取省市列表失败<br>请检查网络"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findAllProvince.json",e,t,i)},cityItemInit:function(e){var t=e.attr("data-code"),i=$("#cityListContainer").find("#province"+t);jsonData={placeCode:t},successFunc=function(n){for(var a=n.object,o=a.length,r="",s=0;s<o;s++){var l=a[s];r+='<li class="inline-block"><div class="item-content"><div class="item-inner"><a class="button theme-btn-hollow city-item" data-province="'+t+'" data-code="'+l.placeCode+'" data-carNo="'+l.licenseCode+'" data-fullName="'+l.placeFullName+'" data-postNo="'+l.postCode+'">'+l.placeName+"</a></div></div></li>"}i.empty().append(r).addClass("expanded"),e.removeClass("init"),e.find(".icon").removeClass("icon-right").addClass("icon-down"),$.hideIndicator()},failFunc=function(e){$.alert("获取城市列表失败！"),console.info(e),$.hideIndicator()},e.hasClass("init")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findAllCity.json",jsonData,successFunc,failFunc)):i.hasClass("expanded")?(e.find(".icon").removeClass("icon-down").addClass("icon-right"),i.removeClass("expanded")):(e.find(".icon").removeClass("icon-right").addClass("icon-down"),i.addClass("expanded"))},cityFill:function(e){var t=e.attr("data-province"),i=e.attr("data-fullName"),n=e.attr("data-code"),a=e.attr("data-carNo");$("#provinceCode").val(t),$("#placeName").val(i),$("#placeCode").val(n),$("#licenseNo").val(a),$.closeModal("#citySelectPopup")},linkToNext:function(){if($.getCookie("userData"))var e=JSON.parse($.getCookie("userData"));else $.alert("登录信息过期啦，请重新登录！"),router.linkTo("./login.html");var t=this,i=parseInt($("#newCarTag").val()),n={mobile:$.getCookie("userMobile"),carOwnerInfoId:e.carOwnerInfoId,placeName:$("#placeName").val(),placeCode:$("#placeCode").val(),carOwner:$("#carOwner").val(),identifyNumber:$("#identifyNumber").val(),licenseNo:i?"":$("#licenseNo").val(),brandName:$("#brandName").val(),frameNo:$("#frameNo").val(),engineNo:$("#engineNo").val(),enrollDate:$("#enrollDate").val(),transferFlag:$("#transferFlag").val(),newCarTag:i},a=function(e){"success"==e.status?($.setCookie("licenseNo",$("#licenseNo").val(),3600),$.setCookie("carOwner",$("#carOwner").val(),3600),router.linkTo("./new_insurance_type.html")):$.alert(e.message),$.hideIndicator()},o=function(e){$.hideIndicator(),$.alert("录入信息错误，请稍微重试"),console.info(e)};t.linkToNextValidation()&&($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/insertCarOwnerAndVehicleInfo.json",n,a,o))},linkToNextValidation:function(){var e=$("#licenseNo").val().trim(),t=$("#brandName").val().trim(),i=$("#frameNo").val().trim(),n=$("#engineNo").val().trim(),a=$("#enrollDate").val().trim(),o=$("#carOwner").val().trim(),r=$("#identifyNumber").val().trim(),s=Boolean(parseInt($("#newCarTag").val())),l=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/,c=/^[\u4E00-\u9FA5]+$/,d=/^[A-Z0-9]{17}$/g,u=/^[A-Z0-9]*$/g;return s||e?s||$.checkCarNo(e)?t?i?d.test(i)?n&&u.test(n)?a?o?c.test(o)?r?!!l.test(r)||($.toast("身份证号填写有误！",750),!1):($.toast("请先填写身份证号！",750),!1):($.toast("车主姓名填写有误！",750),!1):($.toast("请先填写车主姓名！",750),!1):($.toast("请先选择注册日期！",750),!1):($.toast("请先填写发动机号！",750),!1):($.toast("车辆识别代号填写有误！",750),!1):($.toast("请先填写车辆识别代号！",750),!1):($.toast("请先填写品牌型号！",750),!1):($.toast("请填写正确的车牌号码！",750),!1):($.toast("请先填写车牌号码！",750),!1)}},newInsuranceTypePage={init:function(){this.domListener()},domListener:function(){var e=this;$("#newInsuranceTypePage .list-block").on("click",".single-option-item .item-after",function(){var t=$(this).closest(".single-option-item");e.switchSingleOption(t)}).on("click",".complex-option-item .item-after",function(){var t=$(this).closest(".complex-option-item");e.switchComplexOption(t)}).on("click",".item-content:not(.not-selected) .sub-title",function(){e.switchFranchise($(this))}),$("#newInsuranceTypePage .step-link-container .button").on("click",function(){e.linkToNext()})},formatData:function(){var e=$.submitObj(),t={},i=[],n={kindCode34:"玻璃险",kindCode36:"自燃损失险",kindCode63:"机动车损失险",kindCode68:"第三者责任险",kindCode73:"司机责任险",kindCode74:"盗抢险",kindCode75:"划痕险",kindCode89:"乘客座位险"};for(var a in e)e[a].indexOf("万")!=-1?t[a]=1e4*parseInt(e[a].replace("万","")):e[a].indexOf("千")!=-1?t[a]=1e3*parseInt(e[a].replace("千","")):"不投保"==e[a]?t[a]=0:"kindCode34"==a?e[a].indexOf("国产")!=-1?t[a]=1:e[a].indexOf("进口")!=-1&&(t[a]=2):isNaN(parseInt(e[a]))?t[a]=e[a]:t[a]=parseInt(e[a]);t.kindCode999&&i.push({amount:"",kindCode:"999",kindName:"交强险"});for(var a in n){var o={};if(t[a]){if(o.kindCode=a.replace("kindCode",""),o.kindName=n[a],o.amount=String(t[a]),t[a+"_CDW"]){var r={kindCode:"A"+a.replace("kindCode",""),kindName:n[a]+"不计免赔",amount:"0"};i.push(r)}i.push(o)}}return i},switchSingleOption:function(e){var t=e.attr("data-valArr")?e.attr("data-valArr").split(","):[0,1],i=e.find(".item-after input"),n=e.find(".select-info");e.hasClass("not-selected")?(e.removeClass("not-selected").addClass("active"),i.val(t[1]),n.text("投保")):(e.removeClass("active").addClass("not-selected"),i.val(t[0]),n.text("不投保"),e.find(".img-checkbox").removeClass("img-checkbox").addClass("img-checkbox-active"),e.find(".sub-title input").val("1"))},switchComplexOption:function(e){var t=e.find(".radio-val").attr("data-val"),i={textArr:e.attr("data-textArr").split(","),valArr:e.attr("data-valArr").split(",")},n=function(){"不投保"==e.find(".select-info").text()?(e.addClass("not-selected"),e.find(".img-checkbox").removeClass("img-checkbox").addClass("img-checkbox-active"),e.find(".sub-title input").val("1")):e.removeClass("not-selected")};i.selectedIndex=i.valArr.indexOf(t),$.radioModal(e,i,n)},switchFranchise:function(e){var t=e.find(".img-icon"),i=e.find("input");t.hasClass("img-checkbox-active")?(t.removeClass("img-checkbox-active").addClass("img-checkbox"),i.val("0")):(t.removeAttr("img-checkbox").addClass("img-checkbox-active"),i.val("1"))},linkToNext:function(){var e=this.formatData();if($.getCookie("userData"))var t=JSON.parse($.getCookie("userData"));else $.alert("登录信息过期啦，请重新登录！"),router.linkTo("./login.html");var i=this,n={carOwnerInfoId:t.carOwnerInfoId,subInsInfoList:e},a=function(e){"success"==e.status?router.linkTo("./wait_page.html"):$.alert(e.message,750),$.hideIndicator()},o=function(e){$.hideIndicator(),$.alert("录入险种错误，请稍微重试"),console.info(e)};i.linkToNextValidation(e)&&($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/insertProduct.json",$.transferJsonData(n),a,o))},linkToNextValidation:function(e){return 0!=e.length||($.toast("未选择任何险种！",750),!1)}},newInsurancePricePage={init:function(){this.priceInit(),this.domListener()},domListener:function(){var e=this;$("#newInsurancePricePage").on("click",".list-container",function(){var t=$(this).attr("data-name"),i=$(this).attr("data-sumprem");$(this).hasClass("available")?e.linkToNext(t,i):$.alert("由于未知原因，无法选择天安保险公司！")}),$(".service-tel-container").on("click","#selectInsuranceType",function(){$.confirm("确认重新报价？",function(){router.linkTo("./new_insurance_info.html")})})},priceInit:function(){var e=JSON.parse($.getCookie("userData")),t=JSON.parse($.getCookie("orderData")),i={orderId:t.orderId},n=function(t){if("success"==t.status){var i=t.object,n="",a={REN_BAO:"人保",PING_AN:"平安",TAI_PING_YANG:"太平洋"},o={REN_BAO:"img-logo-CPIC",PING_AN:"img-logo-PINGAN",TAI_PING_YANG:"img-logo-PICC"};if($("#licenseNo").text(e.licenseNo?e.licenseNo:"--"),0==i.length)n+='<ul class="list-container available" ><li class="item-content no-company">没有公司报价</li></ul>';else for(var r=0;r<i.length;r++){var s=i[r];n+='<ul class="list-container available" data-name='+s.simpleNameEn+' data-sumprem="'+s.sumPrem+'"><li class="item-content"><div class="item-media"><i class="img-icon '+o[s.simpleNameEn]+'"></i></div><div class="item-inner"><div class="item-title">'+a[s.simpleNameEn]+'</div><div class="item-after"><span class="old-price" id="oldPrice">'+(s.amount?s.amount:"")+'</span>&nbsp;<span class="new-price" id="newPrice">'+s.sumPrem+"</span></div></div></li></ul>"}$("#insuranceCompany").empty().append(n)}else $.alert(t.message)},a=function(e){$.hideIndicator(),$.alert("无法获取保险公司报价，请稍微重试"),console.info(e)};$.getCookie("userData")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findInsuranceQuotation.json",i,n,a)):($.alert("登录信息过期"),router.linkTo("./login.html"))},linkToNext:function(e,t){var i=(JSON.parse($.getCookie("userData")),JSON.parse($.getCookie("orderData"))),n={orderId:i.orderId,simpleNameEn:e},a=function(e){"success"==e.status?($.setCookie("sumPremVal",t),$.setCookie("newInsurancePrice",JSON.stringify(e.object[0]),3600),router.linkTo("./new_insurance_submit.html")):$.alert(e.message),$.hideIndicator()},o=function(e){$.hideIndicator(),$.alert("选择保险公司错误，请稍微重试"),console.info(e)};$.getCookie("userData")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/findInsuranceQuotationDetail.json",n,a,o)):($.alert("登录信息过期"),router.linkTo("./login.html"))}},newInsuranceSubmitPage={init:function(){this.infoInit(),this.domListener()},domListener:function(){var e=this;$(".new-insurance-submit-page").on("click","#confirmInsuranceBtn",function(){$.confirm("确认投保？",function(){e.linkToNext()})})},infoInit:function(){var e=this,t=JSON.parse($.getCookie("newInsurancePrice")),i=e.productFilterPrem(t.subInsInfoList),n="";$.autoFill(t),$("#truePayPrice").text(i[0].sumPrem);for(var a=1;a<i.length;a++){var o=i[a];"999"!=o.kindCode&&(n+='<li><div class="item-content added-info-content"><div class="row no-gutter"><div class="col-25 text-left text-bold"><div class="pay-item-name">'+o.kindName+'</div></div><div class="col-75"><div class="flex-box pay-item-info"><div class="flex-item-1 text-center"><span class="cdw-span">'+(o.indemnityTag?"不计免赔":"")+'</span></div><div class="flex-item-1 text-right">'+(o.amount&&"1"!=o.amount?o.amount:"")+'</div><div class="flex-item-1 text-right">'+o.prem+"</div></div></div></div></div></li>")}$("#productKind").empty().append(n)},productFilterPrem:function(e){for(var t=e.length,i=[],n={},a=0;a<t;a++){var o,r=e[a],s=r.kindCode,l=r.kindName,c=r.amount,d=r.prem;if("A"!=s[0])n[s]=i.length,o={kindCode:s,kindName:l,amount:c,prem:d,indemnityTag:!1},i.push(o);else{var u=n[s.slice(1)];i[u].indemnityTag=!0,i[u].prem=(parseFloat(i[u].prem)+parseFloat(d)).toFixed(2)}}return i},linkToNext:function(){var e=JSON.parse($.getCookie("userData")),t=JSON.parse($.getCookie("orderData")),i=JSON.parse($.getCookie("newInsurancePrice")),n=i,a=function(e){"success"==e.status?($.setCookie("newInsuranceSubmit",JSON.stringify(e.object[0]),3600),router.linkTo("./new_insurance_pay.html")):$.alert(e.message),$.hideIndicator()},o=function(e){$.hideIndicator(),$.alert("网络错误，请稍微重试"),console.info(e)};n.resultId=i.subInsInfoList[0].resultId,n.orderId=t.orderId,n.carOwnerInfoId=e.carOwnerInfoId,e?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/updateOrderInfo.json",$.transferJsonData(n),a,o)):($.alert("登录信息过期"),router.linkTo("./login.html"))}},newInsurancePayPage={init:function(){this.infoInit(),this.domListener()},domListener:function(){var e=this;$("#insuranceTermsPopupLink").on("click",function(){$.popup("#insuranceTerms")}),$("#insuranceTermsClosePopup").on("click",function(){$.closeModal("#insuranceTerms")}),$(".popup-link.upload-popup-link").on("click",function(){var e=$(this).attr("data-popup"),t=JSON.parse($.getCookie("userData")),i=e+"_"+t.carOwnerInfoId,n=$(this).hasClass("has-uploaded"),a="./upload_img.html?imgType="+e+"&imgName="+i+"&originUrl=null",o=parent.document.getElementById(e+"Frame").contentWindow.location.href;if(o.indexOf("init=1")!=-1){if(n){var r=defaultConfig.ossPre,s=r+"/"+e+"/"+i+".jpg";a="./upload_img.html?imgType="+e+"&imgName="+i+"&originUrl="+s+"&viewUrl="+s+"&uploaded=1&init=0"}$("#"+e+"Frame").attr("src",a)}$.popup("#"+e+"UploadPopup")}),$(".close-popup.upload-close-popup").on("click",function(){var e=$(this).attr("data-popup"),t=parent.document.getElementById(e+"Frame").contentWindow.location.href;t.indexOf("viewUrl=")!=-1&&($("#"+e+"UploadPopupLink").removeClass("not-uploaded").addClass("has-uploaded"),$("#"+e+"UploadPopupLink .img-icon").removeClass("img-camera").addClass("img-camera-active")),$.closeModal("#"+e+"UploadPopup")}),$(".new-insurance-pay-page").on("change",'.agreement-operate input[type="checkbox"]',function(){e.toggleAgree($(this))}),$("#payMethodPopupLink").on("click",function(){e.submitValidation()&&$.popup("#payMethodPopup")}),$("#jdPay").on("click",function(){e.payOff()}),$("#bfPay").on("click",function(){$.confirm("请确保投保人（当前用户）与被投保车辆的车主保持一致<br>否则将无法进行分期投保",function(){e.instalPayOff()})})},toggleAgree:function(e){var t=$(".new-insurance-pay-page .bar .pay-btn");e.prop("checked")?t.removeClass("click-ban"):t.addClass("click-ban")},infoInit:function(){var e=this,t=JSON.parse($.getCookie("userData")),i=JSON.parse($.getCookie("newInsurancePrice")),n=JSON.parse($.getCookie("newInsuranceSubmit")),a=e.productFilterPrem(i.subInsInfoList),o="",r={TAI_PING_YANG:"【太平洋保险】",PING_AN:"【中国平安】",REN_BAO:"【中国人民保险】"};$.autoFill(t),$.autoFill(i),$.autoFill(n),$("#company").text(r[t.simpleNameEn]),$("#mobile").text($.getCookie("userMobile")),e.uploadedImgInit(t.carOwnerInfoId),$("#truePayPrice").text(i.sumPrem),$("#amout").text(i.sumPrem);for(var s=1;s<a.length;s++){var l=a[s];"999"!=l.kindCode&&(o+='<li><div class="item-content added-info-content"><div class="row no-gutter"><div class="col-25 text-left text-bold"><div class="pay-item-name">'+l.kindName+'</div></div><div class="col-75"><div class="flex-box pay-item-info"><div class="flex-item-1 text-center"><span class="cdw-span">'+(l.indemnityTag?"不计免赔":"")+'</span></div><div class="flex-item-1 text-right">'+(l.amount&&"1"!=l.amount?l.amount:"")+'</div><div class="flex-item-1 text-right">'+l.prem+"</div></div></div></div></div></li>")}$("#productKind").empty().append(o)},productFilterPrem:function(e){for(var t=e.length,i=[],n={},a=0;a<t;a++){var o,r=e[a],s=r.kindCode,l=r.kindName,c=r.amount,d=r.prem;if("A"!=s[0])n[s]=i.length,o={kindCode:s,kindName:l,amount:c,prem:d,indemnityTag:!1},i.push(o);else{var u=n[s.slice(1)];i[u].indemnityTag=!0,i[u].prem=(parseFloat(i[u].prem)+parseFloat(d)).toFixed(2)}}return i},payOff:function(){var e=JSON.parse($.getCookie("userData")),t=JSON.parse($.getCookie("orderData")),i={contactAddressDetails:$("#contactAddressDetails").val().trim(),carOwnerInfoId:e.carOwnerInfoId},n=function(i){var n={userId:e.carOwnerInfoId,tradeNum:t.orderId,tradeName:"临时车险支付订单",amount:$.getCookie("sumPremVal"),simpleNameEn:e.simpleNameEn},a=function(e){"fail"==e.status?$.alert(e.message):setTimeout(function(){for(var t in e.object)$("#submitForm").find("#form_"+t).val(e.object[t]);$("#submitForm").submit()},1e3),$.hideIndicator()},o=function(e){$.alert("支付失败<br>请稍后重试"),$.hideIndicator(),console.info(e)};$.getCookie("userData")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/jdpay/submit.json",n,a,o)):($.alert("登录信息过期"),router.linkTo("./login.html"))},a=function(e){$.hideIndicator(),$.alert("网络错误，请稍微重试"),console.info(e)};$.getCookie("userData")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/updateCarOwnerInfo.json",i,n,a)):($.alert("登录信息过期"),router.linkTo("./login.html"))},instalPayOff:function(){var e=JSON.parse($.getCookie("userData")),t={contactAddressDetails:$("#contactAddressDetails").val().trim(),carOwnerInfoId:e.carOwnerInfoId},i=function(e){"fail"==e.status?($.hideIndicator(),$.alert(e.message)):($.hideIndicator(),router.linkTo("./new_insurance_instalment.html"))},n=function(e){$.hideIndicator(),$.alert("网络错误，请稍微重试"),console.info(e)};$.getCookie("userData")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/updateCarOwnerInfo.json",t,i,n)):($.alert("登录信息过期"),router.linkTo("./login.html"))},uploadedImgInit:function(e){for(var t=defaultConfig.ossPre,i=["idCardImgEmblem","idCardImgHead","drivingLicenseFirst","drivingLicenseSecond"],n=function(e){return"$('#"+e+"UploadPopupLink').removeClass('has-uploaded').addClass('not-uploaded');$('#"+e+"UploadPopupLink .img-icon').removeClass('img-camera-active').addClass('img-camera');"},a=0;a<i.length;a++){var o=t+"/"+i[a]+"/"+i[a]+"_"+e+".jpg",r=n(i[a]);$("#"+i[a]+"Preview").append('<img src="'+o+'" onerror="'+r+'">')}},submitValidation:function(){var e=$("#contactAddressDetails").val().trim(),t=$("#idCardImgEmblemUploadPopupLink").hasClass("has-uploaded"),i=$("#idCardImgHeadUploadPopupLink").hasClass("has-uploaded"),n=$("#drivingLicenseFirstUploadPopupLink").hasClass("has-uploaded"),a=$("#drivingLicenseSecondUploadPopupLink").hasClass("has-uploaded");return e?!!(t&&i&&n&&a)||($.alert("请上传资料附件！"),!1):($.alert("保单邮寄地址不能为空！"),!1)}},newInsuranceInstalmentPage={init:function(){this.infoInit(),this.domListener()},domListener:function(){var e=this;$("#submitInstalmentOrderBtn").on("click",function(){e.submitInstalmentOrder()})},infoInit:function(){var e=.07,t=10,i=parseFloat($.getCookie("sumPremVal")),n=JSON.parse($.getCookie("userData")),a=JSON.parse($.getCookie("orderData")),o=i*(1+e),r=o/t,s=new Date,l=new Date;s.setMonth(s.getMonth()+1),$("#carOwner").text(n.carOwner),$("#licenseNo").text(n.licenseNo),$("#sumPremVal").text(i),$("#refundDate").text(s.getDate()),$("#refundAmountPer").text(parseFloat(r).toFixed(2)),$("#refundDateFirst").text($.formatTime(Date.parse(s)));var c=new Date(Date.parse(l)+288e5),d={orderNo:a.orderId,obtainUserId:n.carOwnerInfoId,obtainUserMobile:n.mobile,obtainUserName:n.carOwner,applyCapital:i,verifyCapital:i,refundType:0,refundDate:s.getDate(),loanType:4,status:0,createDate:c.toISOString(),effectiveDate:c.toISOString(),deadDate:new Date(c.setMonth(c.getMonth()+10)).toISOString()};$.setCookie("instalmentJsonData",JSON.stringify(d),3e3)},submitInstalmentOrder:function(){var e=JSON.parse($.getCookie("instalmentJsonData")),t=function(e){"fail"==e.status?($.hideIndicator(),$.alert(e.message)):($.hideIndicator(),$.alert("保险分期申请已提交<br>即将跳转到app下载页面",function(){location.href="./app_download.html"}))},i=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试"),console.info(e)};$.getCookie("instalmentJsonData")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/addCreditOrder.json",e,t,i)):$.alert("用户登录信息过期<br>请重新登录",function(){var e="http://"+document.URL.split("/")[2]+defaultConfig.project+"/html/login.html";window.location.href=e})},transISOTimeStr:function(e){var t=e.replace(" ","T"),i=new Date(Number(new Date(t)));return i.toISOString()}},waitPage={init:function(){this.updateInfo()},domListener:function(){},infoInit:function(){if($.getCookie("userData")){var e=JSON.parse($.getCookie("userData")),t=JSON.parse($.getCookie("orderData")),i=e.carOwner?e.carOwner:"--",n=e.licenseNo?e.licenseNo:"--";switch($("#carOwner").text(i?i:"--"),$("#licenseNo").text(n?n:"--"),parseInt(t.payStatus)){case 1:router.linkTo("./new_insurance_price.html");break;case 2:router.linkTo("./policy_no_wait.html");break;case 3:router.linkTo("./success_page.html");break;case 4:router.linkTo("./instalment_success.html")}}else $.alert("登录信息过期"),router.linkTo("./login.html")},updateInfo:function(){var e=this,t={mobile:$.getCookie("userMobile"),password:$.getCookie("pwd"),role:1},i=function(t){var i=t.object;"fail"==t.status?$.alert(t.message):($.setCookie("userMobile",i.carOwnerInfoBak.mobile,3600),$.setCookie("userData",JSON.stringify(i.carOwnerInfoBak),3600),$.setCookie("orderData",JSON.stringify(i.vehicleOrderInfo),3600),e.infoInit())},n=function(e){$.alert("自动登录失败<br>请稍微重试"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/login.json",t,i,n)}},instalmentSuccessPage={init:function(){this.domListener()},domListener:function(){$("#appDownloadLink").on("click",function(){location.href="./app_download.html"}),$("#newInsuranceLink").on("click",function(){location.href="./new_insurance_info.html"})}},policyNoWaitPage={init:function(){this.infoInit(),this.domListener()},domListener:function(){},infoInit:function(){}},successPage={init:function(){this.infoInit(),this.domListener()},domListener:function(){},infoInit:function(){var e=JSON.parse($.getCookie("userData")),t=JSON.parse($.getCookie("orderData")),i={carOwnerInfoId:e.carOwnerInfoId},n=function(i){var n=i.object[0];$.autoFill(n),$.autoFill(e),$.autoFill(t),$("#createTime").text($.formatTime(n.createTime)),$("#licenseNo").text()||$("#licenseNo").text("--")},a=function(e){$.alert("获取保单号失败，请稍微重试"),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleInsurance/buyInsuranceSuccess.json",i,n,a)}},userInfoPage={init:function(){this.appLogin(),this.domListener()},domListener:function(){},appLogin:function(){if($.getParameter("mobile")&&$.getParameter("pwd")&&$.getParameter("role")){var e=this,t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:1},i=function(t){"fail"==t.status?($.hideIndicator(),$.alert(t.message)):($.setCookie("userId",t.object.carOwnerInfoBak.carOwnerInfoId,3e3),e.userInfoInit(t.object.carOwnerInfoBak.carOwnerInfoId))},n=function(e){$.hideIndicator(),$.alert("网络连接错误<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/login.json",t,i,n)}else $.toast("请先登录")},userInfoInit:function(e){var t={userId:e},i=function(e){var t=e.object;$.autoFill(t)},n=function(e){$.alert("网络连接出错<br>请稍后重试"),$.hideIndicator(),console.info(e)};$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/findCreditUserInformation.json",t,i,n)}},userInfoEditPage={init:function(){this.userInfoInit(),this.domListener()},domListener:function(){var e=this;$("#mobile").on("focus",function(){$.toast("手机号无法进行修改！")}),$("#saveInfoBtn").on("click",function(){e.saveUserInfo()})},userInfoInit:function(){var e={userId:$.getCookie("userId")},t=function(e){var t=e.object;$.autoFill(t)},i=function(e){$.alert("网络连接出错<br>请稍后重试"),$.hideIndicator(),console.info(e)};e.userId?$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/findCreditUserInformation.json",e,t,i):$.toast("请先登录！")},saveUserInfo:function(){var e=this,t=e.submitObj(),i=function(e){"fail"==e.status?$.alert("修改失败<br>请稍后重试！"):($.hideIndicator(),$.alert("信息修改成功",function(){$.router.back()}))},n=function(e){console.info(e),$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！")};e.submitValidation()&&($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/updateObtainUser.json",t,i,n))},submitObj:function(){var e={};return $("#userInfoEditPage .submit-input").each(function(){var t=$(this).attr("id"),i=$(this).val();e[t]=i}),e},submitValidation:function(){var e=$.trim($("#idCard").val()),t=$.trim($("#bankCardNum").val()),i=$.trim($("#linkman1Name").val()),n=$.trim($("#linkman1Mobile").val()),a=$.trim($("#linkman2Name").val()),o=$.trim($("#linkman2Mobile").val()),r=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/,s=/^(\d{16}|\d{19})$/,l=/^1[34578]\d{9}$/;return e&&!r.test(e)?($.toast("身份证号填写有误！",750),!1):t&&!s.test(t)?($.toast("银行卡号填写有误！",750),!1):i&&n?l.test(n)?a&&o?!(o&&!l.test(o))||($.toast("联系人2手机号填写有误！",750),!1):($.toast("请填写紧急联系人2的信息！",750),!1):($.toast("联系人1手机号填写有误！",750),!1):($.toast("请填写紧急联系人1的信息！",750),!1)}},creditMobileStatusPage={init:function(){this.infoInit(),this.domListener()},domListener:function(){
var e=this;$("#creditMobile").on("click",function(){e.authorizeLinkTo()})},infoInit:function(){console.info("【运营商授权状态】","interface","运营商授权状态","TODO")},authorizeLinkTo:function(){router.linkTo("credit_mobile.html"),console.info("【运营商授权】","点击授权链接，根据授权状态判断是否需要弹出提示")}},creditMobilePage={init:function(){this.infoInit(),this.domListener()},domListener:function(){var e=this;$("#tipsPopupLink").on("click",function(){$.popup("#tipsPopup")}),$("#requestCodeBtn").on("click",function(){e.countFunc("#requestCodeBtn"),e.getMobileCode()}),$("#authorizeBtn").on("click",function(){e.authorizeMobile()}),$("#unauthorizeBtn").on("click",function(){e.unauthorizeMobile()})},infoInit:function(){console.info("【运营商授权】","interface","填写基础信息：手机号，另外判断用户是否已经填写身份证号和真实姓名，否则不允许进行授权","TODO")},getMobileCode:function(){console.info("【运营商授权】","interface","将用户填写的密码提交，开始获取对应的验证码","TODO")},getTaskStatus:function(e){console.info("【运营商授权】","interface","根据对应的taskId，查询该任务的进度","TODO")},authorizeMobile:function(){console.info("【运营商授权】","interface","提交获取到的验证码，开始授权","TODO")},secondGetTaskStatus:function(e){console.info("【运营商授权】","interface","第二次查询任务状态，判断是否需要二次验证","TODO")},secondAuthorizeMobile:function(){console.info("【运营商授权】","interface","第二次提交获取到的验证码，开始授权","TODO")},unauthorizeMobile:function(){$.toast("取消授权功能完善中...",750)},submitValidation:function(){var e=$.trim($("#mobile").val()),t=$.trim($("#password").val()),i=/^1[34578]\d{9}$/;return""==e?($.toast("手机号不能为空！",750),!1):i.test(e)?""==t?($.toast("密码不能为空！",750),!1):6==t.length||($.toast("运营商密码长度为6位！",750),!1):($.toast("手机号填写有误！",750),!1)},countFunc:function(e){var t=$(e),i=59,n=setInterval(function(){t.text("("+i+"s)"),i--<=0&&(clearInterval(n),t.text("重新发送").removeClass("click-ban"))},1e3);t.addClass("click-ban"),t.text("(60s)")}},orderListPage={init:function(){this.appLogin(),this.domListener()},domListener:function(){},orderListInit:function(e){var t=this,i={obtainUserId:e},n=function(e){if("fail"==e.status)$.hideIndicator(),$.alert(e.message);else{var i=e.object;orderListStr=t.getOrderListStr(i),setTimeout(function(){0==i.length?($("#orderListContainer").addClass("no-orders"),$.hideIndicator()):($("#orderListMenu").removeClass("init").empty().append(orderListStr),$.hideIndicator())},1e3)}},a=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findVehicleCreditOrderForCheck.json",i,n,a)},getOrderListStr:function(e){for(var t="",i=0,n=e.length;i<n;i++){var a=e[i],o="",r=$.orderStatusTrans(a.status),s={TAI_PING_YANG:"太平洋保险",PING_AN:"中国平安保险",REN_BAO:"中国人民保险"},l="";switch(a.status){case 7:l="onclick=\"router.linkTo('order_detail_confirm.html?orderNo="+a.orderNo+"')\";";break;case 8:case 9:case 10:l="";break;default:l="onclick=\"router.linkTo('order_detail.html?orderNo="+a.orderNo+"')\";"}o+='<li class="card"><div class="card-header row no-gutter" '+l+'><div class="col-50 text-left loan-amount text-yellow text-lg text-bold">'+a.verifyCapital.toFixed(2)+'</div><div class="col-50 text-right loan-status">'+r+'<i class="icon icon-right"></i></div></div><div class="card-content"><div class="card-content-inner"><p class="business-info">'+s[a.simpleNameEn]+'</p><p class="added-info"><span class="loan-project">车险</span><span class="loan-date">'+a.effectiveDate+"&nbsp;借</span></p></div></div></li>",t+=o}return t},appLogin:function(){var e=this;if($.getParameter("mobile")&&$.getParameter("pwd")&&$.getParameter("role")){var t={mobile:$.getParameter("mobile"),password:$.getParameter("pwd"),role:1},i=function(t){if("fail"==t.status)$.alert(t.message);else{var i=t.object.carOwnerInfoBak.carOwnerInfoId;$.setCookie("carOwnerInfoId",i,3600),e.orderListInit(i)}},n=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleCreditUser/login.json",t,i,n)}else $.toast("请先登录！")}},orderDetailPage={init:function(){this.orderInit(),this.domListener()},domListener:function(){var e=this;$("#applyRemit").on("click",function(){e.applyRemit()}),$("#repayDetailPopupLink").on("click",function(){e.viewRepayDetail()})},orderInit:function(){var e={orderNo:$.getParameter("orderNo")},t=function(e){if("fail"==e.status)$.hideIndicator(),$.alert(e.message);else{var t=e.object[0],i=$("#orderDetailPage"),n=$("#applyBtnContainer"),a="";i.removeClass("invisible"),$("#orderDetailPage .submit-input").each(function(){var e=$(this).attr("id");$(this).text(t[e])}),$("#applyCapital").text(parseFloat(t.verifyCapital).toFixed(2)),$("#loanInterestObtainFinal").text(parseFloat(t.loanInterestObtainFinal).toFixed(2)),$("#repayDetailPopupLink").addClass("hidden"),0==t.status?a='<p class="text-lg text-bold apply-result">很可惜</p><p>您的订单还未提交</p>':2==t.status?a='<p class="text-lg text-bold apply-result">请稍等</p><p>您的借款申请正在审核</p>':3==t.status?a='<p class="text-lg text-bold apply-result">很抱歉</p><p>您的借款申请未通过审核</p>':4==t.status?a='<p class="text-lg text-bold apply-result">请稍等</p><p>您的借款申请正在审批中</p>':5==t.status?a='<p class="text-lg text-bold apply-result">很抱歉</p><p>您的借款申请未通过审批</p>':1==t.status?(a='<p class="text-lg text-bold apply-result">恭喜您</p><p>您的借款申请已通过审批，请确认</p>',n.removeClass("hidden"),$("#applyCapital").text(parseFloat(t.verifyCapital).toFixed(2)),$("#repayDetailPopupLink").removeClass("hidden")):6==t.status&&(a='<p class="text-lg text-bold apply-result">恭喜您</p><p>您的借款申请正等待财务放款</p>',$("#applyCapital").text(parseFloat(t.verifyCapital).toFixed(2)),$("#repayDetailPopupLink").removeClass("hidden")),$("#orderStatusTip").empty().append(a),$("#refundType").text(0==t.refundType?"等额本息":"等额本金"),$.hideIndicator()}},i=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findCreditOrderDetail.json",e,t,i)},applyRemit:function(){var e={orderNo:$.getParameter("orderNo")},t=function(e){"fail"==e.status?($.hideIndicator(),$.alert(e.message)):($.hideIndicator(),$.alert("已提交后台<br>请耐心等待工作人员处理",function(){$.router.back()}))},i=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！"),console.info(e)};$.confirm("请核对借款金额及借款期数<br>确定提交？",function(){$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/finalConfirmVehicleOrder.json",e,t,i)})},viewRepayDetail:function(){var e={orderNo:$.getParameter("orderNo"),filter:"all"},t=function(e){if("fail"==e.status)$.hideIndicator(),$.alert(e.message);else{for(var t=e.object.orderList,i=t.length,n="<ul>",a=0;a<i;a++){var o=t[a],r="0"==o.payStatus?" not-repayed":" has-repayed",s="0"==o.payStatus?"未还":"已还",l="0"==o.payStatus?o.instalmentRefundDate:o.payTime,c=a+1+"/"+i+"&nbsp;|&nbsp;"+$.formatTime(l)+s;n+='<li class="card bottom-border top-border'+r+'"><div class="card-header"><div class="text-left repay-amount text-yellow text-lg text-bold">'+parseFloat(o.finalPrice).toFixed(2)+'</div><div class="text-right repay-status">'+c+'</div></div><div class="card-content"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50">本金：<span class="text-lg">'+o.instalmentCapital+'</span>元</div><div class="col-50">利息：<span class="text-lg">'+o.instalmentInterest+"</span>元</div></div></div></div></li>"}n+="</ul>",popupHTML='<div id="repayDetailPopup" class="popup repay-detail-popup repay-detail-page"><header class="bar bar-nav"><a class="icon icon-down pull-right close-popup text-grey"></a><h1 class="title">分期详情概览</h1></header><div class="content"><div id="repayBillContainer" class="list-block cards-list">'+n+"</div></div></div>",setTimeout(function(){$.hideIndicator(),$.popup(popupHTML)},1e3)}},i=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findAllVehicleCreditSubOrder.json",e,t,i)}},orderDetailConfirmPage={init:function(){this.orderInfoInit(),this.domListener()},domListener:function(){var e=this;$("#contractPopupLink").on("click",function(){e.contractInfoInit()}),$("#repayRecordLink").on("click",function(){router.linkTo("repay_record.html?orderNo="+$.getParameter("orderNo"))}),$("#repayBillLink").on("click",function(){router.linkTo("repay_bill_per.html?orderNo="+$.getParameter("orderNo"))}),$("#repayDetailLink").on("click",function(){router.linkTo("repay_detail.html?orderNo="+$.getParameter("orderNo"))})},orderInfoInit:function(){var e={orderNo:$.getParameter("orderNo")},t=function(e){var t=e.object;"fail"==e.status?($.hideIndicator(),$.alert(e.message)):($.hideIndicator(),$.autoFill(t),$("#usingPeriod").text(parseInt(t.period)-parseInt(t.donePeriod)),$("#contractExpire").text(t.effectiveDate+" ~ "+t.deadDate),$("#refundType").text(0==t.refundType?"等额本息":"等额本金"),$("#usingMoney").text(parseFloat($("#usingMoney").text()).toFixed(2)),$("#verifyCapital").text(parseFloat($("#verifyCapital").text()).toFixed(2)),$("#refundedInstalmentCapital").text(parseFloat($("#refundedInstalmentCapital").text()).toFixed(2)),$("#refundedInstalmentInterest").text(parseFloat($("#refundedInstalmentInterest").text()).toFixed(2)),$("#loanInterestObtainFinal").text(parseFloat($("#loanInterestObtainFinal").text()).toFixed(2)))},i=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findvehicleCreditOrderDetailByApproved.json",e,t,i)},contractInfoInit:function(){var e={orderNo:$.getParameter("orderNo")},t=function(e){if("fail"==e.status)$.hideIndicator(),$.alert(e.message);else{var t=e.object,i=e.object.userBankList[0],n=e.object.vehicleInfo[0];for(var a in t)$("#contract_"+a).text(t[a]);for(var a in i)$("#contract_"+a).text(i[a]);for(var a in n)$("#contract_"+a).text(n[a]);$("#contract_idCardCopy").text($("#contract_idCard").text()),$("#contract_periodCopy").text($("#contract_period").text()),$("#contract_effectiveDate").text($("#contract_effectiveDate").text().slice(-2)),$("#contract_transferFlag").text(parseInt($("#contract_transferFlag").text())?"是":"否");var o=t.effectiveDate.split(""),r=t.deadDate.split("");o[4]="年",o[7]="月",o.push("日"),r[4]="年",r[7]="月",r.push("日"),$("#startEndDateContainer").text(o.join("")+"起至"+r.join("")+"止"),setTimeout(function(){$.hideIndicator(),$.popup("#contractPopup"),$("#contractPopup").removeClass("init")},1e3)}},i=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试"),console.info(e)};$("#contractPopupLink").hasClass("init")?($.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findVehicleCreditContractInfo.json",e,t,i)):$.popup("#contractPopup")}},repayRecordPage={init:function(){this.repayRecordsInfoInit(),this.domListener()},domListener:function(){},repayRecordsInfoInit:function(){var e={orderNo:$.getParameter("orderNo"),filter:"hasRepay"},t=function(e){if("fail"==e.status)$.hideIndicator(),$.alert(e.message);else{for(var t=e.object.orderList,i=t.length,n="<ul>",a=0;a<i;a++){var o=t[a];n+='<li class="card"><div class="card-header row no-gutter"><div class="col-50 text-left repay-date text-sm">'+$.formatTime(o.payTime,"full")+'</div><div class="col-50 text-right"><span class="repay-amount text-yellow text-lg text-bold">'+parseFloat(o.finalPrice).toFixed(2)+'</span></div></div><div class="card-content"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50 text-sm repayed-principal">本金：<span class="text-bold">'+parseFloat(o.instalmentCapital).toFixed(2)+'</span>元</div><div class="col-50 text-sm handling-charge">利息：<span class="text-bold">'+parseFloat(o.instalmentInterest).toFixed(2)+'</span>元</div></div><div class="row no-gutter"><div class="col-50 text-sm">违约金：<span class="text-bold">'+parseFloat(o.instalmentLatefee).toFixed(2)+"</span>元</div></div></div></div></li>"}n+="</ul>",setTimeout(function(){0==i?$("#repayRecordContainer").empty().addClass("no-records"):$("#repayRecordContainer").empty().append(n),$.hideIndicator()},1e3)}},i=function(e){$.hideIndicator(),$.alert("网络连接出错<br>请稍后重试！"),console.info(e)};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findAllVehicleCreditSubOrder.json",e,t,i)}},repayBillPerPage={init:function(){this.repayBillPerInfoInit(),this.domListener()},domListener:function(){var e=this;$(".repay-bill-per-page").on("change",'.repay-list input[type="radio"]',function(){e.toggleRepay()}),$("#repayBillBtn").on("click",function(){$.confirm("确定立即还款？",function(){e.repayBill()})})},repayBillPerInfoInit:function(){var e=this,t={orderNo:$.getParameter("orderNo"),filter:"toRepay"},i=function(t){for(var i=t.object.orderList,n=i.length,a="<ul>",o=0;o<n;o++){var r=parseFloat(i[o].instalmentCapital),s=parseFloat(i[o].instalmentInterest),l=i[o].instalmentLatefee?parseFloat(i[o].instalmentLatefee):0,c=r+s+l;"2"!=i[o].payStatus&&"4"!=i[o].payStatus&&"9"!=i[o].payStatus&&(a+='<li><label class="label-checkbox item-content"><div class="item-inner"><div class="card"><div class="card-header"><div class="text-left repay-amount text-yellow text-lg text-bold">'+c.toFixed(2)+'</div><div class="text-right repay-status text-grey text-xs">'+i[o].instalmentRefundDate+'&nbsp;待还</div></div><div class="card-content added-info"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50 repayed-principal">本金：<span class="text-lg">'+r.toFixed(2)+'</span></div><div class="col-50 repayed-interest">利息：<span class="text-lg">'+s.toFixed(2)+'</span></div><div class="col-50 repayed-interest">违约金：<span class="text-lg">'+l.toFixed(2)+'</span></div></div></div></div></div></div><input type="radio" name="repay-item" data-amount="'+c.toFixed(2)+'" data-billno="'+i[o].instalmentNo+'"><div class="item-media"><i class="icon icon-form-checkbox"></i></div></label></li>')}a+="</ul>",$("#repayBillList").empty().append(a),e.pageEffectInit(),$.hideIndicator()},n=function(e){$.alert("网络连接出错<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findAllVehicleCreditSubOrder.json",t,i,n)},pageEffectInit:function(){$('.repay-bill-per-page .repay-list input[type="radio"]').eq(0).prop("checked",!0),this.countSummary()},countSummary:function(){var e=0;$('.repay-bill-per-page .repay-list input[type="radio"]').each(function(){if($(this).prop("checked")){var t=parseFloat($(this).attr("data-amount"));e+=t}}),$(".repay-bill-per-page .repay-summary .summary-val").text(e.toFixed(2))},toggleRepay:function(){var e=0,t=$(".repay-bill-per-page .repay-btn a");this.countSummary(),$('.repay-bill-per-page .repay-list input[type="radio"]').each(function(){$(this).prop("checked")&&(e+=1)}),0==e?t.addClass("click-ban"):t.removeClass("click-ban")},repayBill:function(){var e={userId:$.getCookie("carOwnerInfoId"),tradeNum:"",tradeName:"还款订单",amount:0},t=function(e){setTimeout(function(){var t=$("#batchForm");for(var i in e.object)t.find("#"+i).val(e.object[i]);t.attr("action",defaultConfig.jdUrl).submit()},1500)},i=function(e){$.hideIndicator(),$.alert("支付失败！")};$('.repay-bill-per-page .repay-list input[type="radio"]').each(function(){$(this).prop("checked")&&(e.tradeNum=$(this).attr("data-billno"),e.amount=100*parseFloat($(this).attr("data-amount")))}),$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/jdpay/submit.json",e,t,i)}},repayDetailPage={init:function(){this.repayDetailInfoInit(),this.domListener()},domListener:function(){},repayDetailInfoInit:function(){var e={orderNo:$.getParameter("orderNo"),filter:"all"},t=function(e){for(var t=e.object.orderList,i=t.length,n="<ul>",a=0;a<i;a++){var o=t[a],r="0"==o.payStatus?" not-repayed":" has-repayed",s="0"==o.payStatus?"未还":"已还",l="0"==o.payStatus?o.instalmentRefundDate:o.payTime,c=a+1+"/"+i+"&nbsp;|&nbsp;"+$.formatTime(l)+s;n+='<li class="card bottom-border top-border'+r+'"><div class="card-header"><div class="text-left repay-amount text-yellow text-lg text-bold">'+parseFloat(o.finalPrice).toFixed(2)+'</div><div class="text-right repay-status">'+c+'</div></div><div class="card-content"><div class="card-content-inner"><div class="row no-gutter"><div class="col-50">本金：<span class="text-lg">'+o.instalmentCapital+'</span>元</div><div class="col-50">利息：<span class="text-lg">'+o.instalmentInterest+"</span>元</div></div></div></div></li>"}n+="</ul>",setTimeout(function(){$("#repayBillContainer").empty().append(n),$.hideIndicator()},1e3)},i=function(e){$.alert("网络连接出错<br>请稍后重试")};$.showIndicator(),$.ajaxAction(defaultConfig.domain+defaultConfig.project+"/vehicleLoanOrder/findAllVehicleCreditSubOrder.json",e,t,i)}},insurance={loginPage:loginPage,loginWechatPage:loginWechatPage,registerPage:registerPage,newInsuranceInfoPage:newInsuranceInfoPage,newInsuranceTypePage:newInsuranceTypePage,newInsurancePricePage:newInsurancePricePage,newInsuranceSubmitPage:newInsuranceSubmitPage,newInsuranceInstalmentPage:newInsuranceInstalmentPage,newInsurancePayPage:newInsurancePayPage,userInfoPage:userInfoPage,userInfoEditPage:userInfoEditPage,creditMobileStatusPage:creditMobileStatusPage,creditMobilePage:creditMobilePage,orderListPage:orderListPage,orderDetailPage:orderDetailPage,orderDetailConfirmPage:orderDetailConfirmPage,repayRecordPage:repayRecordPage,repayBillPerPage:repayBillPerPage,repayDetailPage:repayDetailPage,instalmentSuccessPage:instalmentSuccessPage,waitPage:waitPage,policyNoWaitPage:policyNoWaitPage,successPage:successPage};window.insurance=insurance,$(document).on("pageInit",function(){router.setPage()}),$.init();